window.jsgv_en_us={trunk:"Game move",comment:"Comment",result:"Result",white:"White",back:"Back",move_number_after:"",w:"W",fast_back:"Fast back",komi:"Komi",black:"Black",b:"B",cancel:"Cancel",submit:"OK",jump_to:"Jump to",whose_turn:"Next",branch:"Variation",moves:"Moves",handicap:"Handicap",time:"Time",end:"Forward to end",forward:"Forward",prev_comment_or_branch:"Previous comment or variation",refresh:"Refresh game/board",fast_forward:"Fast forward",white_dead:"W dead",black_dead:"B dead",play_first:"Play first",next_comment_or_branch:"Next comment or variation",show_hide_move_number:"Show/hide move number",branch_tag:"<Variation>",comment_for:"Comment for MOVE",place:"Place",home:"Back to beginning",open_in_new_window:"Open in new window",resign:"Resign",move_number_before:"",rule:"Rule",jump_to_xx:"Jump to XX"};window.jsgv_zh_cn={move_number_after:"",back:"上一手",white:"白方",result:"结果",comment:"评论",trunk:"实战",fast_back:"快退",w:"白",submit:"执行",cancel:"取消",b:"黑",black:"黑方",komi:"贴目/子",whose_turn:"下一手",jump_to:"跳到第",time:"时间",handicap:"让子",moves:"手数",branch:"变化",refresh:"刷新棋谱内容",prev_comment_or_branch:"上一评论或变化图",forward:"下一手",end:"到棋局结束",black_dead:"黑被提",white_dead:"白被提",fast_forward:"快进",next_comment_or_branch:"下一评论或变化图",play_first:"先行",show_hide_move_number:"显示/隐藏手数",move_number_before:"",resign:"认输",open_in_new_window:"在新窗口打开",home:"到棋局开始",place:"地点",comment_for:"第MOVE手评论",branch_tag:"<变化>",jump_to_xx:"跳到第XX手",rule:"规则"};jQuery(document).ready(function(){tb_init("a.thickbox, area.thickbox, input.thickbox")});function tb_init(b){jQuery(b).click(function(){var f=this.title||this.name||null;var d=this.href||this.alt;var h=this.rel||false;tb_show(f,d,h);return false})}function tb_show(b,d,f){try{if(typeof document.body.style.maxHeight==="undefined"){jQuery("body","html").css({height:"100%",width:"100%"});jQuery("html").css("overflow","hidden");if(document.getElementById("TB_HideSelect")===null){jQuery("body").append("<iframe id='TB_HideSelect'></iframe><div id='TB_overlay'></div><div id='TB_window'></div>");jQuery("#TB_overlay").click(tb_remove)}}else{if(document.getElementById("TB_overlay")===null){jQuery("body").append("<div id='TB_overlay'></div><div id='TB_window'></div>");jQuery("#TB_overlay").click(tb_remove)}}if(tb_detectMacXFF()){jQuery("#TB_overlay").addClass("TB_overlayMacFFBGHack")}else{jQuery("#TB_overlay").addClass("TB_overlayBG")}if(b===null){b=""}var g;if(d.indexOf("?")!==-1){g=d.substr(0,d.indexOf("?"))}else{g=d}var l=d.replace(/^[^\?]+\??/,"");var k=tb_parseQuery(l);TB_WIDTH=(k.width*1)+30||630;TB_HEIGHT=(k.height*1)+40||440;ajaxContentW=TB_WIDTH-30;ajaxContentH=TB_HEIGHT-45;if(jQuery("#TB_window").css("display")!="block"){if(k.modal!="true"){jQuery("#TB_window").append("<div id='TB_title'><div id='TB_ajaxWindowTitle'>"+b+"</div><div id='TB_closeAjaxWindow'><a href='#' id='TB_closeWindowButton'>close</a> or Esc Key</div></div><div id='TB_ajaxContent' style='width:"+ajaxContentW+"px;height:"+ajaxContentH+"px'></div>")}else{jQuery("#TB_overlay").unbind();jQuery("#TB_window").append("<div id='TB_ajaxContent' class='TB_modal' style='width:"+ajaxContentW+"px;height:"+ajaxContentH+"px;'></div>")}}else{jQuery("#TB_ajaxContent")[0].style.width=ajaxContentW+"px";jQuery("#TB_ajaxContent")[0].style.height=ajaxContentH+"px";jQuery("#TB_ajaxContent")[0].scrollTop=0;jQuery("#TB_ajaxWindowTitle").html(b)}jQuery("#TB_closeWindowButton").click(tb_remove);jQuery("#TB_ajaxContent").html(jQuery("#"+k.inlineId).html());jQuery("#TB_window").unload(function(){jQuery("#"+k.inlineId).html(jQuery("#TB_ajaxContent").html())});tb_position();jQuery("#TB_load").remove();jQuery("#TB_window").css({display:"block"});document.onkeyup=function(m){if(m==null){keycode=event.keyCode}else{keycode=m.which}if(keycode==27){tb_remove()}};if(k.focus!=null){jQuery("#"+k.focus).focus()}}catch(h){}}function tb_remove(){jQuery("#TB_imageOff").unbind("click");jQuery("#TB_closeWindowButton").unbind("click");jQuery("#TB_window").fadeOut("fast",function(){jQuery("#TB_window,#TB_overlay,#TB_HideSelect").trigger("unload").unbind().remove()});jQuery("#TB_load").remove();if(typeof document.body.style.maxHeight=="undefined"){jQuery("body","html").css({height:"auto",width:"auto"});jQuery("html").css("overflow","")}document.onkeydown="";document.onkeyup="";return false}function tb_position(){jQuery("#TB_window").css({marginLeft:"-"+parseInt((TB_WIDTH/2),10)+"px",width:TB_WIDTH+"px"});if(!(jQuery.browser.msie&&jQuery.browser.version<7)){jQuery("#TB_window").css({marginTop:"-"+parseInt((TB_HEIGHT/2),10)+"px"})}}function tb_parseQuery(g){var h={};if(!g){return h}var b=g.split(/[;&]/);for(var f=0;f<b.length;f++){var l=b[f].split("=");if(!l||l.length!=2){continue}var d=unescape(l[0]);var k=unescape(l[1]);k=k.replace(/\+/g," ");h[d]=k}return h}function tb_getPageSize(){var f=document.documentElement;var b=window.innerWidth||self.innerWidth||(f&&f.clientWidth)||document.body.clientWidth;var d=window.innerHeight||self.innerHeight||(f&&f.clientHeight)||document.body.clientHeight;arrayPageSize=[b,d];return arrayPageSize}function tb_detectMacXFF(){var b=navigator.userAgent.toLowerCase();if(b.indexOf("mac")!=-1&&b.indexOf("firefox")!=-1){return true}}var jsgvTranslations=jsgv_en_us;var jsGameViewer=function(){return{name:"jsgameviewer",version:"1.0a",length:0,WEIQI:0,DAOQI:1,EN_US:"en_us",ZH_CN:"zh_cn",LOCALES:["en_us","zh_cn"],CONFIG:{baseDir:"/jsgameviewer/",viewDir:"/jsgameviewer/view/",locale:"en_us",gameType:0,boardSize:19,playerInterval:5,observerInterval:15,container:null},getGameId:function(b){if(b==undefined){this.length++;for(b=1;this["GV"+b]!=null;b++){}}return"GV"+b},createClass:function(){return function(){this.initialize.apply(this,arguments)}},clone:function(f){if(typeof(f)!="object"){return f}if(f==null){return f}var d=new Object();for(var b in f){d[b]=this.clone(f[b])}return d},notNull:function(b){return b!=undefined&&b!=null&&jQuery.trim(b).length>0},getId:function(b,d){return b+"-"+d}}}();var jsgv=jsGameViewer;jsGameViewer.model=function(){var w=0;var B=1;var u=2;var f=3;var D=0;var s=1;var q=2;var t=0;var F=1;var o=2;var A=0;var v=1;var h=2;var k=3;var z=4;var l=5;var b=6;var x=7;var m=8;var r=9;var n=jsGameViewer.createClass();jQuery.extend(n.prototype,{initialize:function(H,G){this.val=H;this.depth=0;if(G!=undefined&&G!=null){this.depth=G}}});var E=jsGameViewer.createClass();jQuery.extend(E.prototype,{initialize:function(G,K,H,I,J){this.x=G;this.y=K;this.id=G+"-"+K;this.color=0;if(H!=undefined&&H!=null){this.color=H}this.moveNumber=null;if(I!=undefined&&I!=null){this.moveNumber=I}this.deleteFlag=false;if(J){this.deleteFlag=true}}});var y=jsGameViewer.createClass();jQuery.extend(y,Array);jQuery.extend(y.prototype,{initialize:function(G,H){this.gameType=G;this.size=H;this.reset()},isNeighbor:function(H,J,G,I){if(this.gameType==jsGameViewer.DAOQI){if(H==G){return J==(I+1)%this.size||J==(I-1+this.size)%this.size}if(J==I){return H==(G+1)%this.size||H==(G-1+this.size)%this.size}return false}else{if(H==G){return J==I+1||J==I-1}if(J==I){return H==G+1||H==G-1}return false}},normalize:function(G){if(G<0){return G+this.size}if(G>=this.size){return G-this.size}return G},reset:function(){for(i=0;i<this.size;i++){this[i]=new Array(this.size);for(j=0;j<this.size;j++){this[i][j]=0}}},copyFrom:function(G){for(var I=0;I<this.size;I++){for(var H=0;H<this.size;H++){this[I][H]=G[I][H]}}},getDeadGroup:function(G,I){if(this.gameType==jsGameViewer.DAOQI){G=this.normalize(G);I=this.normalize(I)}else{if(G<0||G>=this.size||I<0||I>=this.size){return null}}if(this[G][I]==0){return null}if(this.gameType==jsGameViewer.DAOQI){if(this[this.normalize(G-1)][I]==0||this[this.normalize(G+1)][I]==0||this[G][this.normalize(I-1)]==0||this[G][this.normalize(I+1)]==0){return null}}else{if((G>0&&this[G-1][I]==0)||(G<this.size-1&&this[G+1][I]==0)||(I>0&&this[G][I-1]==0)||(I<this.size-1&&this[G][I+1]==0)){return null}}var H=new Array();H.color=this[G][I];H.push([G,I]);H[G+"-"+I]=true;if(this.gameType==jsGameViewer.DAOQI){if(this.expandDeadGroup(H,G-1,I)){return null}if(this.expandDeadGroup(H,G+1,I)){return null}if(this.expandDeadGroup(H,G,I-1)){return null}if(this.expandDeadGroup(H,G,I+1)){return null}}else{if(G>0&&this.expandDeadGroup(H,G-1,I)){return null}if(G<this.size-1&&this.expandDeadGroup(H,G+1,I)){return null}if(I>0&&this.expandDeadGroup(H,G,I-1)){return null}if(I<this.size-1&&this.expandDeadGroup(H,G,I+1)){return null}}return H},expandDeadGroup:function(H,G,I){if(this.gameType==jsGameViewer.DAOQI){G=this.normalize(G);I=this.normalize(I)}if(H[G+"-"+I]!=null){return false}if(this[G][I]!=H.color){return false}if(this.gameType==jsGameViewer.DAOQI){if(this[this.normalize(G-1)][I]==0||this[this.normalize(G+1)][I]==0||this[G][this.normalize(I-1)]==0||this[G][this.normalize(I+1)]==0){return true}}else{if((G>0&&this[G-1][I]==0)||(G<this.size-1&&this[G+1][I]==0)||(I>0&&this[G][I-1]==0)||(I<this.size-1&&this[G][I+1]==0)){return true}}H.push([G,I]);H[G+"-"+I]=true;if(this.gameType==jsGameViewer.DAOQI){if(this.expandDeadGroup(H,G-1,I)){return true}if(this.expandDeadGroup(H,G+1,I)){return true}if(this.expandDeadGroup(H,G,I-1)){return true}if(this.expandDeadGroup(H,G,I+1)){return true}}else{if(G>0&&this.expandDeadGroup(H,G-1,I)){return true}if(G<this.size-1&&this.expandDeadGroup(H,G+1,I)){return true}if(I>0&&this.expandDeadGroup(H,G,I-1)){return true}if(I<this.size-1&&this.expandDeadGroup(H,G,I+1)){return true}}return false}});var C=jsGameViewer.createClass();jQuery.extend(C.prototype,{initialize:function(G){this.type=t;this.parent=G;this.children=new Array();this.moveNumber=0;this.depth=0;this.points=new Array();this.processed=false;this.blackPrisoners=0;this.blackPrisonerPoints=[];this.whitePrisoners=0;this.whitePrisonerPoints=[]},isRoot:function(){return this.parent==null},hasChildren:function(){return this.children.length>0},firstChild:function(){if(this.children.length>0){return this.children[0]}return null},isOnBranch:function(){return this.depth>1},isDummyNode:function(){return this.type==t&&!this.isRoot()&&this.comment==null&&this.marks==null},hasComment:function(){return this.comment!=undefined&&this.comment!=null&&jQuery.trim(this.comment).length>0},hasBranches:function(){return this.children.length>1},toString:function(){var G="";var H="EMPTY";if(this.type==F){H="MOVE"}else{if(this.type==o){H="PASS"}}var I=G+"Node("+H+", "+this.moveNumber;if(this.type==F||this.type==o){I+=", "+(this.color==B?"black":"white")}if(this.type==F){I+=", "+this.x+","+this.y}I+=")";return I}});var g=jsGameViewer.createClass();jQuery.extend(g.prototype,{initialize:function(G){this.type=G;this.charset="";this.name="";this.boardSize=19;this.rule="";this.handicap=0;this.komi=0;this.blackName="";this.blackRank="";this.whiteName="";this.whiteRank="";this.date="";this.place="";this.result="";this._moves=0;this._firstPlayer=w;this.rootNode=new C(null)},isFinished:function(){return this.result&&this.result.length>0},getMoves:function(){if(this._moves==0){var G=this.rootNode;while(G.hasChildren()){G=G.children[0];if(G.moveNumber!=undefined&&G.moveNumber!=null){this._moves=G.moveNumber}}}return this._moves},getFirstPlayer:function(){if(this._firstPlayer==w){var G=this.rootNode;while(this._firstPlayer==w&&G.hasChildren()){G=G.children[0];if(G.type==F||G.type==o){this._firstPlayer=G.color}}}return this._firstPlayer},getId:function(){var G=this.url;return G},getTitle:function(){var G="";if(this.name){G+=this.name+": "}if(this.whiteName){G+=this.whiteName}else{G+="Unknown Player"}G+="(W) - ";if(c.game.blackName){G+=c.game.blackName}else{G+="Unknown Player"}G+="(B)";if(this.result){G+="   "+this.result}if(this.date){G+="   "+this.date}if(this.place){G+="   "+this.place}return G},getNextPlayer:function(){var H=w;var I=this.rootNode;while(I.hasChildren()){if(I.color==B||I.color==u){H=I.color}var J=I.children[0];if(J.temp){break}I=J}if(I.color==B||I.color==u){H=I.color}var G=H==B?u:B;return G}});var p=jsGameViewer.createClass();jQuery.extend(p.prototype,{initialize:function(G){this.game=G;this.board=new y(G.type,G.boardSize);this.currentNode=G.rootNode;this.rootNode=this.currentNode;this.blackPrisoners=0;this.blackPrisonerPoints=[];this.whitePrisoners=0;this.whitePrisonerPoints=[];this.moveNumbers=new Object();this.tempMoves=new Array();this.processCurrentNode()},isFirst:function(){return this.currentNode.isRoot()},isLast:function(){return !this.currentNode.hasChildren()},isOnBranch:function(){return this.currentNode.isOnBranch()},getNextPlayer:function(){var H=this.currentNode;var G=H.color;while(G!=B&&G!=u&&!H.isRoot()){H=H.parent;G=H.color}if(G==B){G=u}else{if(G==u){G=B}else{H=this.currentNode;while(G!=B&&G!=u&&H.hasChildren()){H=H.children[0];G=H.color}}}if(!G||G==w){G=B}return G},getMoveNumber:function(H,I){var G=this.moveNumbers[jsGameViewer.getId(H,I)];if(G instanceof Number){return G}if(G!=undefined&&G!=null){return G.val}return 0},handleDeadGroup:function(H){var G=this;if(H!=null){if(H.color==B){G.currentNode.blackPrisoners+=H.length;G.blackPrisoners+=H.length}else{G.currentNode.whitePrisoners+=H.length;G.whitePrisoners+=H.length}jQuery.each(H,function(K,M){var J=M[0],O=M[1],L=G.moveNumbers[jsGameViewer.getId(J,O)];var N=[J,O,H.color,L,G.currentNode.moveNumber];if(H.color==B){G.currentNode.blackPrisonerPoints.push(N);G.blackPrisonerPoints.push(N)}else{G.currentNode.whitePrisonerPoints.push(N);G.whitePrisonerPoints.push(N)}G.board[J][O]=0;var I=new E(J,O,H.color,L,true);G.currentNode.points.push(I);delete G.moveNumbers[jsGameViewer.getId(J,O)]})}},processCurrentNode:function(){var H=this;var M=this.board;var I=this.currentNode;if(I.processed){for(var K=0;K<I.points.length;K++){var Q=I.points[K];if(Q.deleteFlag){M[Q.x][Q.y]=0}else{M[Q.x][Q.y]=Q.color}this.moveNumbers[jsGameViewer.getId(Q.x,Q.y)]=Q.moveNumber}if(I.blackPrisoners>0){this.blackPrisoners+=I.blackPrisoners;this.blackPrisonerPoints=this.blackPrisonerPoints.concat(I.blackPrisonerPoints)}if(I.whitePrisoners>0){this.whitePrisoners+=I.whitePrisoners;this.whitePrisonerPoints=this.whitePrisonerPoints.concat(I.whitePrisonerPoints)}return}I.processed=true;switch(I.type){case t:jQuery.each(I.points,function(W,U){var T=U.x,Y=U.y,V=U.color;if(T<0||T>=M.size||Y<0||Y>=M.size){return}switch(V){case f:U.color=M[T][Y];U.deleteFlag=true;var X=[T,Y,U.color,H.moveNumbers[jsGameViewer.getId(T,Y)],I.moveNumber];if(U.color==B){I.blackPrisoners++;H.blackPrisoners++;I.blackPrisonerPoints.push(X);H.blackPrisonerPoints.push(X)}else{if(U.color==u){I.whitePrisoners++;H.whitePrisoners++;I.whitePrisonerPoints.push(X);H.whitePrisonerPoints.push(X)}}M[T][Y]=0;break;case B:case u:M[T][Y]=V;break}});break;case F:var P=I.x,N=I.y,J=I.color,S=this.game.boardSize;if(P<0||P>=S||N<0||N>=S){throw"Invalid point: ("+P+","+N+")"}M[P][N]=J;var R=new n(I.moveNumber,I.depth);H.moveNumbers[jsGameViewer.getId(P,N)]=R;var Q=new E(P,N,J,R);I.points.push(Q);var L=(J==B)?u:B;if(H.game.type==jsGameViewer.DAOQI){var G=M.normalize(P-1);var O=N;if(M[G][O]==L){this.handleDeadGroup(M.getDeadGroup(G,O))}G=M.normalize(P+1);O=N;if(M[G][O]==L){this.handleDeadGroup(M.getDeadGroup(G,O))}G=P;O=M.normalize(N-1);if(M[G][O]==L){this.handleDeadGroup(M.getDeadGroup(G,O))}G=P;O=M.normalize(N+1);if(M[G][O]==L){this.handleDeadGroup(M.getDeadGroup(G,O))}}else{if(P>0){var G=P-1,O=N;if(M[G][O]==L){this.handleDeadGroup(M.getDeadGroup(G,O))}}if(P<M.size-1){var G=P+1,O=N;if(M[G][O]==L){this.handleDeadGroup(M.getDeadGroup(G,O))}}if(N>0){var G=P,O=N-1;if(M[G][O]==L){this.handleDeadGroup(M.getDeadGroup(G,O))}}if(N<M.size-1){var G=P,O=N+1;if(M[G][O]==L){this.handleDeadGroup(M.getDeadGroup(G,O))}}}this.handleDeadGroup(M.getDeadGroup(P,N));break;case o:break}if(!I.hasChildren()){if(!I.isOnBranch()&&this.last==null){H.last=new Object();H.last.node=I;H.last.board=jsGameViewer.clone(M);H.last.moveNumbers=jsGameViewer.clone(this.moveNumbers);H.last.blackPrisoners=this.blackPrisoners;H.last.blackPrisonerPoints=jsGameViewer.clone(this.blackPrisonerPoints);H.last.whitePrisoners=this.whitePrisoners;H.last.whitePrisonerPoints=jsGameViewer.clone(this.whitePrisonerPoints)}}},play:function(M,L){var J=this.board;if(M<0||M>=J.size||L<0||L>=J.size){return false}if(J[M][L]!=0){return false}var K=this.getNextPlayer();var H=(K==B)?u:B;J[M][L]=K;var I=0;if(M>0&&J[M-1][L]==H){var O=J.getDeadGroup(M-1,L);if(O!=null){I=O.length}}if(I<2&&M<J.size-1&&J[M+1][L]==H){var O=J.getDeadGroup(M+1,L);if(O!=null){I=+O.length}}if(I<2&&L>0&&J[M][L-1]==H){var O=J.getDeadGroup(M,L-1);if(O!=null){I=+O.length}}if(I<2&&L<J.size-1&&J[M][L+1]==H){var O=J.getDeadGroup(M,L+1);if(O!=null){I=+O.length}}var G=true;if(I==1){if(this.currentNode.type==F){if(J.isNeighbor(M,L,this.currentNode.x,this.currentNode.y)&&(this.currentNode.blackPrisoners==1||this.currentNode.whitePrisoners==1)){G=false}}}else{if(I==0){var O=J.getDeadGroup(M,L);if(O!=null&&O.length>0){G=false}}}if(!G){J[M][L]=0;return false}var N=new C(this.currentNode);N.temp=true;N.type=F;N.x=M;N.y=L;N.color=K;N.moveNumber=this.currentNode.moveNumber+1;if(this.currentNode.children.length==0){N.depth=this.currentNode.depth}else{N.depth=this.currentNode.depth+1}if(!N.isOnBranch()){this.last=null}this.currentNode.children.push(N);this.tempMoves.push([M,L]);return this.goToBranch(this.currentNode.children.length-1)},canRemove:function(){if(this.currentNode.temp){return true}else{return false}},remove:function(){if(this.canRemove()){var I=this.currentNode;var H=I.parent;var G=0;for(G=0;G<H.children.length;G++){if(H.children[G]==I){break}}this.back();H.children.splice(G,1);if(!I.isOnBranch()){this.last=null}}},back:function(){if(this.currentNode.isRoot()){return false}for(var H=0;H<this.currentNode.points.length;H++){var G=this.currentNode.points[H];if(G.deleteFlag){this.board[G.x][G.y]=G.color;this.moveNumbers[jsGameViewer.getId(G.x,G.y)]=G.moveNumber}else{this.board[G.x][G.y]=w;delete this.moveNumbers[jsGameViewer.getId(G.x,G.y)]}}if(this.currentNode.blackPrisoners>0){this.blackPrisoners-=this.currentNode.blackPrisoners;for(var H=0;H<this.currentNode.blackPrisoners;H++){if(this.blackPrisonerPoints.length>0){this.blackPrisonerPoints.pop()}}}if(this.currentNode.whitePrisoners>0){this.whitePrisoners-=this.currentNode.whitePrisoners;for(var H=0;H<this.currentNode.whitePrisoners;H++){if(this.whitePrisonerPoints.length>0){this.whitePrisonerPoints.pop()}}}this.currentNode=this.currentNode.parent;return true},backAll:function(){this.currentNode=this.rootNode;this.board.reset();this.moveNumbers=new Object();this.blackPrisoners=0;this.blackPrisonerPoints=[];this.whitePrisoners=0;this.whitePrisonerPoints=[];var G=this.board;jQuery.each(this.currentNode.points,function(I,H){G[H.x][H.y]=H.color})},forward:function(){if(!this.currentNode.hasChildren()){return false}this.currentNode=this.currentNode.children[0];this.processCurrentNode();return true},forwardAll:function(){if(this.isOnBranch()||this.last==null){while(this.forward()){}}else{this.currentNode=this.last.node;this.board.copyFrom(this.last.board);this.moveNumbers=jsGameViewer.clone(this.last.moveNumbers);this.blackPrisoners=this.last.blackPrisoners;this.blackPrisonerPoints=jsGameViewer.clone(this.last.blackPrisonerPoints);this.whitePrisoners=this.last.whitePrisoners;this.whitePrisonerPoints=jsGameViewer.clone(this.last.whitePrisonerPoints)}},goToBranch:function(G){if(!this.currentNode.hasChildren()){return false}if(this.currentNode.children.length<=G){return false}this.currentNode=this.currentNode.children[G];this.processCurrentNode();return true}});var d=new Array();jQuery.extend(d,{max:30,save:function(I){var K=I.game.getId();var G=null;for(var H=0;H<this.length;H++){if(this[H]==K){G=H;break}}if(G!=null&&G>0){for(var H=0;H<G-1;H++){this[H+1]=this[H]}}else{this.unshift(K);if(this.length>this.max){var J=this.pop();delete this[J]}}this[0]=K;this[K]=I}});return{STONE_NONE:w,STONE_BLACK:B,STONE_WHITE:u,STONE_ERASE:f,MODE_NORMAL:D,MODE_EDIT:s,MODE_SCORE:q,NODE_EMPTY:t,NODE_MOVE:F,NODE_PASS:o,MARK_NONE:A,MARK_SQUARE:v,MARK_CIRCLE:h,MARK_TRIANGLE:k,MARK_CROSS:z,MARK_TEXT:l,MARK_NUMBER:b,MARK_TERR_BLACK:x,MARK_TERR_WHITE:m,MARK_STONE:r,MoveNumber:n,Point:E,Board:y,Game:g,GameState:p,Node:C,GameHistory:d}}();jsGameViewer.SGFParser=jsGameViewer.createClass();jsGameViewer.SGFParser.prototype=function(){var K=jsGameViewer.WEIQI;var n=jsGameViewer.model.Game;var s=jsGameViewer.model.Node;var q=jsGameViewer.model.Point;var E=jsGameViewer.model.STONE_NONE;var A=jsGameViewer.model.STONE_BLACK;var I=jsGameViewer.model.STONE_WHITE;var J=jsGameViewer.model.NODE_MOVE;var z=jsGameViewer.model.NODE_PASS;var y=97;var b=0;var L=1;var l=2;var d=0;var m=1;var F=2;var N=3;var k=4;var B=5;var M=6;var t=0;var x=1;var H=2;var D=3;var g=4;var C=5;var o=6;var v=7;var u="10";function f(P){this.gameType=P}function O(S,R,P){var Q;if(S!=-1){Q=S}else{if(R!=-1){Q=R}else{Q=P}}if(S<Q&&S!=-1){Q=S}if(R<Q&&R!=-1){Q=R}if(P<Q&&P!=-1){Q=P}return Q}function w(P,Q){while(true){c=P.charAt(Q);if(c==" "||c=="\t"||c=="\n"||c=="\r"){Q++}else{break}}return Q}function r(P,S,R){var Q="SGFParser: ";if(S>0){Q+=P.substring(0,S-1)}Q+="{PARSING FAILED HERE: ";if(R!=undefined&&R!=null){Q+=R}Q+="}";if(S<P.length){Q+=P.substring(S)}return Q}function G(R,T){var S;var Q=R.length;var P="";S=R.indexOf(T+"[");if(S==-1){return P}S+=2;if(R.charAt(S)!="["){throw r(R,S)}while(R.charAt(++S)!="]"&&S<Q){P+=R.charAt(S)}if(S>Q){throw r(R,S)}return P}function h(Q){var P=new n(this.gameType);R=G(Q,"GM");if(R.length>0&&u==R){P.type=DAOQI}var R=G(Q,"SZ");if(R.length>0){try{P.boardSize=parseInt(R)}catch(S){throw r(Q,Q.indexOf("SZ["))}}R=G(Q,"GN");if(R.length>0){P.name=R}R=G(Q,"CA");if(R.length>0){P.charset=R}R=G(Q,"PW");if(R.length>0){P.whiteName=R}R=G(Q,"WR");if(R.length>0){P.whiteRank=R}R=G(Q,"PB");if(R.length>0){P.blackName=R}R=G(Q,"BR");if(R.length>0){P.blackRank=R}R=G(Q,"RU");if(R.length>0){P.rule=R}R=G(Q,"KM");if(R.length>0){try{P.komi=parseFloat(R)}catch(S){throw r(Q,Q.indexOf("KM["))}}R=G(Q,"HA");if(R.length>0){try{P.handicap=parseInt(R)}catch(S){throw r(Q,Q.indexOf("HA["))}}R=G(Q,"RE");if(R.length>0){P.result=R}R=G(Q,"DT");if(R.length>0){P.date=R}R=G(Q,"PC");if(R.length>0){P.place=R}return P}function p(ab){var X=0;try{ab=ab.replace(/&/g,"&amp;");ab=ab.replace(/</g,"&lt;");var ao=h(ab);var T=ab.length;var V=b;var X=0;var P=0;var ae=0;var W=0;var ag=0;var ai=true;var am=0;var Z=-1;var Y=-1;var ah=E;var ad=false;var Q="";var ac=t;var an="";var U=ao.rootNode;var aj=new Array();do{P=ab.indexOf("(",ag);ae=ab.indexOf(")",ag);W=ab.indexOf(";",ag);X=O(P,ae,W);if(V==L&&X==ae){V=l}if(V==L&&X==P){V=b}else{if(V==b&&X==W){V=L}else{if(V==l&&X==P){V=b}}}switch(V){case b:if(X!=P){throw r(ab,X)}aj.push(U);ag=X+1;break;case l:if(X!=ae){throw r(ab,X)}U=aj.pop();am=U.moveNumber;ag=X+1;break;case L:if(X!=W){throw r(ab,X)}if(ai){ai=false}else{if(U.isDummyNode()&&U.parent!=null){U.parent.children.pop();U=U.parent}var R=new s(U);R.moveNumber=am;if(aj.length>0){R.depth=aj[aj.length-1].depth+1}U.children.push(R);U=R}var S;X++;do{var aa=0;X=w(ab,X);if(ab.charAt(X)=="B"&&ab.charAt(aa=w(ab,X+1))=="["){S=d;X=aa;ah=A}else{if(ab.charAt(X)=="W"&&ab.charAt(aa=w(ab,X+1))=="["){S=m;X=aa;ah=I}else{if(ab.charAt(X)=="A"&&ab.charAt(X+1)=="B"&&ab.charAt(aa=w(ab,X+2))=="["){S=F;X=aa;ad=true;ah=A}else{if(ab.charAt(X)=="A"&&ab.charAt(X+1)=="W"&&ab.charAt(aa=w(ab,X+2))=="["){S=N;X=aa;ad=true;ah=I}else{if(ab.charAt(X)=="A"&&ab.charAt(X+1)=="E"&&ab.charAt(aa=w(ab,X+2))=="["){S=k;X=aa;ad=true;ah=STONE_ERASE}else{if(ab.charAt(X)=="T"&&ab.charAt(X+1)=="R"&&ab.charAt(aa=w(ab,X+2))=="["){S=M;ac=H;X=aa}else{if(ab.charAt(X)=="C"&&ab.charAt(X+1)=="R"&&ab.charAt(aa=w(ab,X+2))=="["){S=M;ac=g;X=aa}else{if(ab.charAt(X)=="S"&&ab.charAt(X+1)=="Q"&&ab.charAt(aa=w(ab,X+2))=="["){S=M;ac=D;X=aa}else{if(ab.charAt(X)=="M"&&ab.charAt(X+1)=="A"&&ab.charAt(aa=w(ab,X+2))=="["){S=M;ac=x;X=aa}else{if(ab.charAt(X)=="L"&&ab.charAt(X+1)=="B"&&ab.charAt(aa=w(ab,X+2))=="["){S=M;ac=C;X=aa;oldLabel=false}else{if(ab.charAt(X)=="C"&&ab.charAt(aa=w(ab,X+1))=="["){S=B;X=aa}else{if(ab.charAt(X)=="T"&&ab.charAt(X+1)=="B"&&ab.charAt(aa=w(ab,X+2))=="["){S=M;ac=o;X=aa;ah=A}else{if(ab.charAt(X)=="T"&&ab.charAt(X+1)=="W"&&ab.charAt(aa=w(ab,X+2))=="["){S=M;ac=v;X=aa;ah=I}else{if(ab.charAt(X)==";"||ab.charAt(X)=="("||ab.charAt(X)==")"){X=w(ab,X);continue}else{var al=ab.indexOf("]",X)+1;if(al<=0){ag=X+1;break}X=al;X=w(ab,X);continue}}}}}}}}}}}}}}do{if(ab.charAt(X)!="["){throw r(ab,X)}if(ab.charAt(X+1)=="]"){if(S==d||S==m){U.type=z;U.color=ah;U.moveNumber=++am}X+=2;continue}switch(S){case d:case m:Z=ab.charCodeAt(X+1)-y;Y=ab.charCodeAt(X+2)-y;U.type=J;if(Z>=19||Y>=19){U.type=z}U.color=ah;U.x=Z;U.y=Y;U.moveNumber=++am;X+=4;break;case F:case N:case k:Z=ab.charCodeAt(X+1)-y;Y=ab.charCodeAt(X+2)-y;U.points.push(new q(Z,Y,ah));X+=4;break;case B:if(U.comment==null){U.comment=""}while(ab.charAt(++X)!="]"||(ab.charAt(X-1)=="\\"&&ab.charAt(X)=="]")){if(!(ab.charAt(X)=="\\"&&ab.charAt(X+1)=="]")&&!(ab.charAt(X)=="\\"&&ab.charAt(X+1)=="[")&&!(ab.charAt(X)=="\\"&&ab.charAt(X+1)==")")&&!(ab.charAt(X)=="\\"&&ab.charAt(X+1)=="(")){U.comment+=ab.charAt(X)}if(X>T){throw r(ab,T)}}X++;break;case M:while(ab.charAt(X)=="["&&X<T){Z=ab.charCodeAt(X+1)-y;Y=ab.charCodeAt(X+2)-y;X+=3;an="";if(ac==C){if(ab.charAt(X)!=":"){throw r(ab,X)}while(ab.charAt(++X)!="]"&&X<T){an+=ab.charAt(X)}try{var af=parseInt(an);ac=C}catch(ak){ac=C}}if(U.marks==null){U.marks=new Array()}U.marks.push([Z,Y,ac,an]);X++;X=w(ab,X)}break}X=w(ab,X)}while(ad&&ab.charAt(X)=="[");X=w(ab,X)}while(ab.charAt(X)!=";"&&ab.charAt(X)!="("&&ab.charAt(X)!=")"&&X<T);X=w(ab,X);ag=X;break;default:throw r(ab,ag)}}while(ag<T&&X>=0);if(U.isDummyNode()&&U.parent!=null){U.parent.children.pop()}return ao}catch(ak){throw r(ab,X,ak)}}return{initialize:f,parse:p}}();jsGameViewer.GameController=jsGameViewer.createClass();jQuery.extend(jsGameViewer.GameController.prototype,{initialize:function(b){this.id=jsGameViewer.getGameId();this.jqId="#"+this.id;jsGameViewer[this.id]=this;this.config=jsGameViewer.clone(jsGameViewer.CONFIG);if(b!=null){jQuery.extend(this.config,b)}this.reset()},init:function(){this.initView();this._initialized=true;return this},initialized:function(){return this._inialized==true},changeLocale:function(b){if(this.config.locale==b){return this}if(!jsGameViewer.LOCALES.indexOf(b)<0){alert("jsGameViewer WARNING: Invalid locale '"+b+"'");return this}this.config.locale=b;window.jsgvTranslations=window["jsgv_"+b];jsGameViewer.WEIQI_TEMPLATE=null;jsGameViewer.DAOQI_TEMPLATE=null;this.reset();this.show();if(this.gameState){this.gameState.backAll();this.initGame()}return this},destroy:function(){this.destroyView();delete jsGameViewer[this.id];jsGameViewer.length--},reset:function(){this._initialized=false;if(this.config.container!=null){var b=jQuery("#"+this.config.container);if(b.get(0).nodeName=="DIV"){b.empty().append(this.getPlaceHolder())}else{if(jQuery(this.jqId).get(0)){jQuery(this.jqId).replaceWith(this.getPlaceHolder())}else{b.after(this.getPlaceHolder())}}}else{if(jQuery(this.jqId).get(0)!=null){jQuery(this.jqId).replaceWith(this.getPlaceHolder())}else{document.write(this.getPlaceHolder())}}return this},show:function(){if(!this.initialized()){this.init()}jQuery(this.jqId).show();return this},hide:function(){jQuery(this.jqId).hide();return this},setGameType:function(b){if(this.config.gameType!=b){this.config.gameType=b;this.reset()}return this},setGameTypeIf:function(b){if(this.config.gameType!=jsGameViewer.DAOQI&&this.game.type==jsGameViewer.DAOQI){this.setGameType(jsGameViewer.DAOQI)}return this},load:function(b,g){var d=jsGameViewer.model.GameHistory[b];if(d){jsGameViewer.model.GameHistory.save(d);this.game=d.game;this.setGameTypeIf(this.game.type).show();this.gameState=d;this.gameState.backAll();this.initGame();if(g==undefined){this.forwardAll()}else{this.forwardN(g)}return this}var f=this;jQuery.ajax({url:b,success:function(h){try{if(f.game&&f.game.dataSize&&f.game.dataSize==h.length){return}f.game=new jsGameViewer.SGFParser(f.config.gameType).parse(h);f.game.dataSize=h.length;f.setGameTypeIf(f.game.type).show();f.game.url=b;f.gameState=new jsGameViewer.model.GameState(f.game);jsGameViewer.model.GameHistory.save(f.gameState);f.initGame();if(g==undefined){f.forwardAll()}else{f.forwardN(g)}}catch(k){throw"GameController.load('"+b+"')->success: "+k}},failure:function(){throw"GameController.load('"+b+"')->failure:"}});return this},loadSgf:function(b,f){try{this.show();this.game=new jsGameViewer.SGFParser(this.config.gameType).parse(b);this.game.dataSize=b.length;this.setGameTypeIf(this.game.type);this.gameState=new jsGameViewer.model.GameState(this.game);this.initGame();if(f==undefined){this.forwardAll()}else{this.forwardN(f)}return this}catch(d){throw"GameController.loadSgf('"+b+"'): "+d}},loadInline:function(b,f){try{if(jQuery("#"+b).length==0){return this}loadSgf(jQuery("#"+b).text(),f);return this}catch(d){throw"GameController.loadInline('"+b+"'): "+d}},refresh:function(d){var b=this.game.url;var f=this;jQuery.ajax({url:b,ifModified:true,success:function(g){try{if(!d&&f.game&&_thi.game.dataSize&&f.game.dataSize==g.length){return}f.game=new jsGameViewer.SGFParser(f.config.gameType).parse(g);f.game.dataSize=g.length;f.setGameTypeIf(f.game.type).show();f.game.url=b;f.gameState=new jsGameViewer.model.GameState(f.game);jsGameViewer.model.GameHistory.save(f.gameState);f.initGame();f.forwardAll()}catch(h){throw"GameController.refresh('"+b+"')->success: "+h}},failure:function(){throw"GameController.refresh('"+b+"')->failure:"}})},openInWindow:function(){var d=this.config.baseDir+"/php/game_window.php?";var h="jsgameviewer",f=722,b=452;if(this.config.gameType==jsGameViewer.DAOQI){d+="type=DAOQI&";f=798;b=528}if(this.game&&this.game.url){d+="url="+encodeURIComponent(this.game.url)}var g=window.open(d,h,"width="+f+"px,height="+b+"px,status=yes,location=no,resizable=yes")},getPlaceHolder:function(){return"<div id='"+this.id+"' style='display:none'>&nbsp;</div>"}});jQuery.extend(jsGameViewer.GameController.prototype,{setPlayer:function(b){this.player=b;return this},saveSession:function(d,b){if(!this.sessionSaver){this.sessionSaver=setInterval(function(){jQuery.ajax({url:d})},b*1000)}return this},setUsernameElemId:function(b){this.usernameElemId=b;return this},setUsername:function(b){this.username=b;return this},getUsername:function(){if(this.username){return this.username}else{if(this.usernameElemId){return jQuery.trim(jQuery("#"+this.usernameElemId).text())}else{return null}}},isPlayer:function(){if(this.player&&this.player.isPlayer){return this.player.isPlayer()}else{return false}},isMyTurn:function(){if(this.player&&this.player.isMyTurn){return this.player.isMyTurn()}else{return false}},sendMove:function(){if(this.player&&this.player.sendMove){return this.player.sendMove()}else{alert("Õâ²»ÊÇDGS¶Ô¾Ö¡£±¾³ÌÐòÄ¿Ç°Ö»Ö§³ÖÔÚDGSÉÏÏÂÆå¡£");return false}},resign:function(){if(this.player&&this.player.resign){var b=confirm("ÄãÈ·ÊµÒªÈÏÊäÂð£¿");if(b){this.player.resign()}}else{alert("Õâ²»ÊÇDGS¶Ô¾Ö¡£±¾³ÌÐòÄ¿Ç°Ö»Ö§³ÖÔÚDGSÉÏÏÂÆå¡£");return false}}});jQuery.extend(jsGameViewer.GameController.prototype,{setPlayerInterval:function(b){this.config.playerInterval=b;return this},setObserverInterval:function(b){this.config.observerInterval=b;return this},startUpdater:function(){this.stopUpdater();if(this.game&&!this.game.isFinished()){return this}var d=this;var b=function(){if(!d.game){return}if(d.game.isFinished()){d.stopUpdater();return}if(d.isMyTurn()){return}d.refresh()};if(this.player){this.playerUpdater=setInterval(b,this.config.playerInterval*1000)}this.observerUpdater=setInterval(b,this.config.observerInterval*1000);return this},stopUpdater:function(){if(this.playerUpdater){clearInterval(this.playerUpdater);delete this.playerUpdater}if(this.observerUpdater){clearInterval(this.observerUpdater);delete this.observerUpdater}return this}});jQuery.extend(jsGameViewer.CONFIG,{gridSize:21,fastMode:10,showMoveNumber:false,activeBackground:"#EECD7A",inactiveBackground:"#CCAB69",boardColor:"#EECD7A",gridSizeWQ:21,gridSizeDQ:19,boardColorDQ:"#CCAB69",vbw:3,boardSizeDQ:25,rightPaneHeight:446,rightPaneHeightDQ:522});jQuery.extend(jsGameViewer.GameController.prototype,function(){var d=["A","B","C","D","E","F","G","H","J","K","L","M","N","O","P","Q","R","S","T"];var b=["A","B","C","D","E","F","G","H","I","J"];return{destroyView:function(){jQuery(this.jqId).remove()},getTemplateLocation:function(){var f=this.config.gameType==jsGameViewer.DAOQI?"daoqi":"weiqi";return this.config.viewDir+"templates/"+f+"_"+this.config.locale+".html"},initView:function(){if(this.initialized()){return this}this.config.x0=this.config.vbw;this.config.y0=this.config.vbw;var f="";if(this.config.gameType==jsGameViewer.DAOQI){this.config.gridSize=this.config.gridSizeDQ;if(jsGameViewer.DAOQI_TEMPLATE==null){jQuery.ajax({async:false,dataType:"application/xml",url:this.getTemplateLocation(),success:function(h){jsGameViewer.DAOQI_TEMPLATE=h}})}f=jsGameViewer.DAOQI_TEMPLATE;this.rightPaneHeight=this.config.rightPaneHeightDQ}else{this.config.gridSize=this.config.gridSizeWQ;if(jsGameViewer.WEIQI_TEMPLATE==null){jQuery.ajax({async:false,dataType:"application/xml",url:this.getTemplateLocation(),success:function(h){jsGameViewer.WEIQI_TEMPLATE=h}})}f=jsGameViewer.WEIQI_TEMPLATE;this.rightPaneHeight=this.config.rightPaneHeight}if(this.id!="GV1"){f=f.replace(/GV1/g,this.id)}jQuery(this.jqId).replaceWith(f);var g=this;jQuery(this.jqId+"_boardFascade").mousemove(function(k){g.registerKeyListener();var h=g.eventToXY(k);jQuery(g.jqId+"_pointLabel").empty().append(g.xyToLabel(h[0],h[1]))}).mouseout(function(h){jQuery(g.jqId+"_pointLabel").empty()}).mousedown(function(k){var h=g.eventToXY(k);g.fromX=h[0];g.fromY=h[1];if(k.ctrlKey&&k.shiftKey){g.sendMove_(h[0],h[1])}else{if(k.ctrlKey||g.config.gameType==jsGameViewer.WEIQI){g.play(h[0],h[1])}else{if(g.config.gameType==jsGameViewer.DAOQI){this.style.cursor="move"}}}}).mouseup(function(k){this.style.cursor="auto";var h=g.eventToXY(k);var m=h[0],l=h[1];if(g.fromX==undefined||g.fromX==NaN||g.fromY==undefined||g.fromY==NaN){return}if(g.fromX!=m||g.fromY!=l){g.moveBoard(m-g.fromX,l-g.fromY)}});this.setToggleNumberImg();jQuery(this.jqId+"_goToInput").keydown(function(){if(e.keyCode==13){gvGoTo(id)}});this.addPrisonerHandlers();this.registerKeyListener();jQuery(document).ready(function(){tb_init("a.thickbox")});return this},addPrisonerHandlers:function(){var f=this;jQuery(this.jqId+"_moveOuter, "+this.jqId+"_blackPrisonersOuter, "+this.jqId+"_whitePrisonersOuter").mouseout(function(){jQuery(f.jqId+"_prisoners").empty()});jQuery(this.jqId+"_blackPrisonersOuter").mouseover(function(){jQuery(f.jqId+"_prisoners").empty();if(f.gameState.blackPrisoners>0){jQuery.each(f.gameState.blackPrisonerPoints,function(g,h){f.showPrisoner(h)})}});jQuery(this.jqId+"_whitePrisonersOuter").mouseover(function(){jQuery(this.jqId+"_prisoners").empty();if(f.gameState.whitePrisoners>0){jQuery.each(f.gameState.whitePrisonerPoints,function(g,h){f.showPrisoner(h)})}});jQuery(this.jqId+"_moveOuter").mouseover(function(){jQuery(f.jqId+"_prisoners").empty();if(f.gameState.currentNode.blackPrisoners>0){jQuery.each(f.gameState.currentNode.blackPrisonerPoints,function(g,h){f.showPrisoner(h)})}if(f.gameState.currentNode.whitePrisoners>0){jQuery.each(f.gameState.currentNode.whitePrisonerPoints,function(g,h){f.showPrisoner(h)})}})},showPrisoner:function(q){var l=this;var o=q[0],m=q[1],k=q[2];var g=this.xyToArea(o,m);var h=g[0],n=g[1],f=g[2],p=g[3];if(this.config.gameType==jsGameViewer.DAOQI){var t=k==jsGameViewer.model.STONE_BLACK?"gvsprite-19-markblack":"gvsprite-19-markwhite";this.mapToPoints(o,m,function(v,y){var z=l.xyToArea(v,y);var B=z[0],A=z[1],x=z[2],u=z[3];var w="<div class='"+t+"' style='position:absolute;left:"+B+"px;top:"+A+"px;";if(l.gameState.board[o][m]==jsGameViewer.model.STONE_NONE){if(l.isInCentralArea(v,y)){w+="background-color:"+l.config.boardColorDQ+";"}else{w+="background-color:"+l.config.boardColor+";"}}w+="'></div>";jQuery(this.jqId+"_prisoners").append(w)})}else{var t=k==jsGameViewer.model.STONE_BLACK?"gvsprite-21-markblack":"gvsprite-21-markwhite";var r="<div class='"+t+"' style='position:absolute;left:"+h+"px;top:"+n+"px;";if(this.gameState.board[o][m]==jsGameViewer.model.STONE_NONE){r+="background-color:"+this.config.boardColor+";"}r+="'></div>";jQuery(this.jqId+"_prisoners").append(r)}},removeKeyListener:function(){jQuery(this.jqId+"_bannerbg").css("background-color",this.config.inactiveBackground)},registerKeyListener:function(){var g=this;for(var f=1;f<=jsGameViewer.length;f++){jsGameViewer[jsGameViewer.getGameId(f)].removeKeyListener()}jQuery(this.jqId+"_bannerbg").css("background-color",this.config.activeBackground);document.onkeydown=function(k){var h;if(window.event){h=window.event.keyCode}else{if(k){h=k.which}else{return}}k=k||window.event;switch(h){case 37:if(k.ctrlKey){if(k.altKey){g.backAll()}else{g.backN(g.config.fastMode)}}else{if(k.altKey&&k.shiftKey){g.backToComment()}else{g.back()}}return;case 39:if(k.ctrlKey){if(k.altKey){g.forwardAll()}else{g.forwardN(g.config.fastMode)}}else{if(k.altKey&&k.shiftKey){g.forwardToComment()}else{g.forward()}}return;case 46:g.remove();return}if(k.altKey&&k.shiftKey){switch(h){case 71:setTimeout("jsGameViewer."+g.id+".goToPopup()",100);break;case 77:g.toggleNumber();break;case 82:g.refresh();break;default:if(h>=65&&h<=90){g.goToBranch(h-65)}}}};return this},initGame:function(){return this.removeAllStones().setGameInfo().setGameState().addRemoveStones(this.gameState.currentNode.points)},setGameInfo:function(){if(this.isMyTurn()){jQuery(this.jqId+"_resign").show()}else{jQuery(this.jqId+"_resign").hide()}var m=jQuery(this.jqId+"_info").empty();var h=this.game;if(h==undefined||h==null){return this}if(jsGameViewer.notNull(h.name)){m.append("<div align='center' style='font-weight:bold'>"+jQuery.trim(h.name)+"</div>")}if(jsGameViewer.notNull(h.date)){m.append("<div>"+jsgvTranslations.time+": "+jQuery.trim(h.date)+"</div>")}if(jsGameViewer.notNull(h.place)){m.append("<div>"+jsgvTranslations.place+": "+jQuery.trim(h.place)+"</div>")}var n="&nbsp;&#8592; "+jsgvTranslations.play_first;var g="";if(jsGameViewer.notNull(h.blackRank)){g="&nbsp;("+h.blackRank+")"}var f="<div>"+jsgvTranslations.black+": <strong>"+jQuery.trim(h.blackName)+"</strong>"+g;if(h.getFirstPlayer()==jsGameViewer.model.STONE_BLACK){f+=n}f+="</div>";m.append(f);var l="";if(jsGameViewer.notNull(h.whiteRank)){l="&nbsp;("+h.whiteRank+")"}var k="<div>"+jsgvTranslations.white+": <strong>"+jQuery.trim(h.whiteName)+"</strong>"+l;if(h.getFirstPlayer()==jsGameViewer.model.STONE_WHITE){k+=n}k+="</div>";m.append(k);if(h.handicap>0){m.append("<div>"+jsgvTranslations.handicap+": "+h.handicap+"</div>")}else{m.append("<div>"+jsgvTranslations.rule+": "+jQuery.trim(h.rule)+"</div>");m.append("<div>"+jsgvTranslations.komi+": "+h.komi+"</div>")}m.append("<div>"+jsgvTranslations.moves+": "+h.getMoves()+"</div>");m.append("<div>"+jsgvTranslations.result+": "+jQuery.trim(h.result)+"</div>");return this},removeGameInfo:function(){jQuery(this.jqId+"_info").empty();return this},setGameState:function(){var f=this.gameState.currentNode;this.setNextPlayer(this.gameState.getNextPlayer());this.setMoveNumber(f.moveNumber);this.setPrisoners(this.gameState.blackPrisoners,this.gameState.whitePrisoners);if(f.type==jsGameViewer.model.NODE_MOVE){this.setMoveMark(f.x,f.y)}else{this.removeMoveMark()}this.setMarks(f.marks);this.setBranches();this.setComment();return this},moveBoard:function(q,o){var m=this;if(this.config.gameType!=jsGameViewer.DAOQI){return}var n=this.gameState.board;this.config.x0=n.normalize(this.config.x0+q);this.config.y0=n.normalize(this.config.y0+o);this.removeAllStones();this.removeBranches();this.removeMoveMark();var t="";for(var l=0;l<n.size;l++){for(var h=0;h<n.size;h++){var g=n[l][h];if(g==jsGameViewer.model.STONE_BLACK||g==jsGameViewer.model.STONE_WHITE){var r=0;if(this.config.showMoveNumber){r=this.gameState.getMoveNumber(l,h)}this.mapToPoints(l,h,function(s,u){t+=m.createStone(s,u,g,r)})}}}if(t.length>0){jQuery(this.jqId+"_boardPoints").append(t)}this.setBranches();var f=this.gameState.currentNode;if(f.type==jsGameViewer.model.NODE_MOVE){this.setMoveMark(f.x,f.y)}else{this.removeMoveMark()}var p=(this.config.y0-this.config.vbw)*this.config.gridSize;jQuery(this.jqId+"_vlabel").css("backgroundPosition","0px "+p+"px");var k=(this.config.x0-this.config.vbw)*this.config.gridSize;jQuery(this.jqId+"_hlabel").css("backgroundPosition",k+"px 0px");this.setMarks(f.marks);return this},mapToPoints_:function(n,l){var p=new Array();var f=n+this.config.x0,m=l+this.config.y0;var g=[];if(f>=0&&f<this.config.boardSizeDQ){g.push(f)}if(f>=this.config.boardSize){g.push(f-this.config.boardSize)}if(f<this.config.boardSizeDQ-this.config.boardSize){g.push(f+this.config.boardSize)}var o=[];if(m>=0&&m<this.config.boardSizeDQ){o.push(m)}if(m>=this.config.boardSize){o.push(m-this.config.boardSize)}if(m<this.config.boardSizeDQ-this.config.boardSize){o.push(m+this.config.boardSize)}for(var k=0;k<g.length;k++){for(var h=0;h<o.length;h++){p.push([g[k],o[h]])}}return p},mapToPoints:function(f,m,l){var k=this.mapToPoints_(f,m);for(var g=0;g<k.length;g++){var h=k[g];l(h[0],h[1])}return this},getStoneId:function(f,g){return this.id+"_point_"+f+"-"+g},createStone:function(m,l,g,o){var k="";if(this.config.gameType==jsGameViewer.DAOQI){if(g==jsGameViewer.model.STONE_BLACK){k="gvsprite-19-black"}else{if(g==jsGameViewer.model.STONE_WHITE){k="gvsprite-19-white"}else{return null}}}else{if(g==jsGameViewer.model.STONE_BLACK){k="gvsprite-21-black"}else{if(g==jsGameViewer.model.STONE_WHITE){k="gvsprite-21-white"}else{return null}}}var p="<div id='"+this.getStoneId(m,l)+"' class='"+k+"' style='position:absolute;left:";a=this.xyToArea(m,l);p+=a[0]+"px;top:"+a[1]+"px;'>";if(this.config.showMoveNumber&&o>0){var h="white";if(g==jsGameViewer.model.STONE_WHITE){h="black"}var n="medium";var f=0;if(o>=10&&o<100){n="small"}else{if(o>=100){n="x-small";f=1}}p+="<div style='display:table;width:"+a[2]+"px;height:"+a[3]+"px;#position:relative;overflow:hidden;'><div style='display:table-cell;vertical-align:middle;#position:absolute;#top:50%;'><div style='#position:relative;left:"+f+"px;width:100%;#top:-50%;text-align:center;color:"+h+";font-family:times;font-size:"+n+";'>"+o+"</div></div></div>"}else{p+="&nbsp;"}p+="</div>";return p},addStone:function(f,m,g){var l=this;var k=0;if(this.config.showMoveNumber){k=this.gameState.getMoveNumber(f,m)}if(this.config.gameType==jsGameViewer.DAOQI){this.mapToPoints(f,m,function(n,p){var o=l.createStone(n,p,g,k);if(o!=null){jQuery(l.jqId+"_boardPoints").append(o)}})}else{var h=this.createStone(f,m,g,k);if(h!=null){jQuery(this.jqId+"_boardPoints").append(h)}}return this},addRemoveStones:function(h){for(var g=0;g<h.length;g++){var f=h[g];this.removeStone(f.x,f.y);if(!f.deleteFlag){this.addStone(f.x,f.y,f.color)}}return this},removeStone:function(f,k){var h=this;if(this.config.gameType==jsGameViewer.DAOQI){this.mapToPoints(f,k,function(l,n){var m=jQuery("#"+h.getStoneId(l,n));m.remove()})}else{var g=jQuery("#"+this.getStoneId(f,k));g.remove()}return this},removeAllStones:function(){jQuery(this.jqId+"_boardPoints").children().remove();return this},setNextPlayer:function(f){var g="";if(f==jsGameViewer.model.STONE_WHITE){g=this.config.viewDir+"/images/15/white.gif"}else{g=this.config.viewDir+"/images/15/black.gif"}jQuery(this.jqId+"_nextPlayer").attr("src",g);return this},setMoveNumber:function(f){if(f==0){f="0"}jQuery(this.jqId+"_curMove").empty().append(f);return this},setMoveMark:function(f,h){var g=this;if(this.config.gameType==jsGameViewer.DAOQI){jQuery(this.jqId+"_moveMarks").empty();this.mapToPoints(f,h,function(k,m){var l=g.xyToArea(k,m);jQuery(g.jqId+"_moveMarks").append("<div class='gvsprite-19-markmove' style='position:absolute;left:"+l[0]+"px;top:"+l[1]+"px;width:"+l[2]+"px;height:"+l[3]+"px'>&nbsp;</div>")})}else{jQuery(this.jqId+"_moveMark").css({position:"absolute",left:f*this.config.gridSize,top:h*this.config.gridSize,width:this.config.gridSize,height:this.config.gridSize})}return this},removeMoveMark:function(){if(this.config.gameType==jsGameViewer.DAOQI){jQuery(this.jqId+"_moveMarks").empty()}else{jQuery(this.jqId+"_moveMark").css({width:0,height:0})}return this},setMarks:function(r){var o=this;jQuery(this.jqId+"_boardMarks").empty();if(r==undefined||r==null){return this}if(this.config.gameType==jsGameViewer.DAOQI){for(var m=0;m<r.length;m++){var k=r[m];var t=k[0],q=k[1];var l=this.gameState.board[t][q];var n="";switch(k[2]){case jsGameViewer.model.MARK_CROSS:n="gvsprite-19-markcross";break;case jsGameViewer.model.MARK_TRIANGLE:n="gvsprite-19-marktriangle";break;case jsGameViewer.model.MARK_SQUARE:n="gvsprite-19-marksquare";break;case jsGameViewer.model.MARK_CIRCLE:n="gvsprite-19-markcircle";break;case jsGameViewer.model.MARK_TERR_BLACK:n="gvsprite-19-markblack";break;case jsGameViewer.model.MARK_TERR_WHITE:n="gvsprite-19-markwhite";break;case jsGameViewer.model.MARK_TEXT:this.mapToPoints(t,q,function(z,F){var C=o.xyToArea(z,F);var E=C[0],D=C[1],B=C[2],w=C[3];var A="<div style='position:absolute;left:"+E+"px;top:"+D+"px;width:"+B+"px;height:"+w+"px;text-align:center;vertical-align:middle;color:red;font-family:Nina;font-weight:bolder;font-size:14px;";if(l==jsGameViewer.model.STONE_NONE){if(o.isInCentralArea(z,F)){A+="background-color:"+o.config.boardColorDQ+";"}else{A+="background-color:"+o.config.boardColor+";"}}A+="'>"+k[3]+"</div>";jQuery(o.jqId+"_boardMarks").append(A)});continue}this.mapToPoints(t,q,function(z,F){var C=o.xyToArea(z,F);var E=C[0],D=C[1],B=C[2],w=C[3];var A="<div class='"+n+"' style='position:absolute;left:"+E+"px;top:"+D+"px;";if(l==jsGameViewer.model.STONE_NONE){if(o.isInCentralArea(z,F)){A+="background-color:"+o.config.boardColorDQ+";"}else{A+="background-color:"+o.config.boardColor+";"}}A+="'></div>";jQuery(o.jqId+"_boardMarks").append(A)})}}else{for(var m=0;m<r.length;m++){var k=r[m];var t=k[0],q=k[1];var l=this.gameState.board[t][q];var g=this.xyToArea(t,q);var h=g[0],p=g[1],f=g[2],u=g[3];var n="";switch(k[2]){case jsGameViewer.model.MARK_CROSS:n="gvsprite-21-markcross";break;case jsGameViewer.model.MARK_TRIANGLE:n="gvsprite-21-marktriangle";break;case jsGameViewer.model.MARK_SQUARE:n="gvsprite-21-marksquare";break;case jsGameViewer.model.MARK_CIRCLE:n="gvsprite-21-markcircle";break;case jsGameViewer.model.MARK_TERR_BLACK:n="gvsprite-21-markblack";break;case jsGameViewer.model.MARK_TERR_WHITE:n="gvsprite-21-markwhite";break;case jsGameViewer.model.MARK_TEXT:var v="<div style='position:absolute;left:"+h+"px;top:"+p+"px;width:"+f+"px;height:"+u+"px;text-align:center;vertical-align:middle;color:red;font-family:Nina;font-weight:bolder;font-size:15px;";if(l==jsGameViewer.model.STONE_NONE){v+="background-color:"+this.config.boardColor+";"}v+="'>"+k[3]+"</div>";jQuery(this.jqId+"_boardMarks").append(v);continue}var v="<div class='"+n+"' style='position:absolute;left:"+h+"px;top:"+p+"px;";if(l==jsGameViewer.model.STONE_NONE){v+="background-color:"+this.config.boardColor+";"}v+="'></div>";jQuery(this.jqId+"_boardMarks").append(v)}}return this},setPrisoners:function(f,g){if(f==0){f="0"}if(g==0){g="0"}jQuery(this.jqId+"_blackPrisoners").empty().append(f);jQuery(this.jqId+"_whitePrisoners").empty().append(g);return this},setBranches:function(){var m=this;jQuery(this.jqId+"_boardBranches").empty();jQuery(this.jqId+"_branches").empty();jQuery(this.jqId+"_branches").css({height:0});var k=this.gameState.currentNode;if(k.hasChildren()&&k.children.length>=2){var h=k.children.length;for(var l=0;l<k.children.length;l++){var r="";if(l==0){r=jsgvTranslations.branch+" A = "+jsgvTranslations.trunk+" [Alt Shift &#8594;][Alt Shift A]"}else{if(l<b.length){var o=b[l];r=jsgvTranslations.branch+" "+o+" [Alt Shift "+o+"]"}}var t="<div class='gvtb-branch gvbutton'><a href='#' title='"+r+"' onclick='jsGameViewer."+this.id+".goToBranch("+l+");return false;'>"+b[l]+"</a></div>";jQuery(this.jqId+"_branches").append(t);jQuery(this.jqId+"_branches").css({height:h*23});var g=k.children[l];if(g.type==jsGameViewer.model.NODE_MOVE){var q=g.x,p=g.y;if(this.config.gameType==jsGameViewer.DAOQI){this.mapToPoints(q,p,function(n,v){var s="gvbranch";if(m.isInCentralArea(n,v)){s="gvbranch-real"}var u=m.xyToArea(n,v);jQuery(m.jqId+"_boardBranches").append("<div class='"+s+"' style='left:"+u[0]+"px;top:"+u[1]+"px;width:"+u[2]+"px;height:"+u[3]+"px;'>"+b[l]+"</div>")})}else{var f=m.xyToArea(q,p);jQuery(m.jqId+"_boardBranches").append("<div class='gvbranch' style='left:"+f[0]+"px;top:"+f[1]+"px;width:"+f[2]+"px;height:"+f[3]+"px;'>"+b[l]+"</div>")}}}}return this},removeBranches:function(){jQuery(this.jqId+"_boardBranches").empty();jQuery(this.jqId+"_branches").empty();jQuery(this.jqId+"_branches").css({height:0});return this},setComment:function(g){var f=this.gameState.currentNode;if(!g){g="<strong>";if(f.depth>1){g+=jsgvTranslations.branch_tag}g+=jsgvTranslations.comment_for.replace(/MOVE/,f.moveNumber)+":</strong>";if(f.comment!=undefined&&f.comment!=null){g+="<br/>"+f.comment.replace(/\n/g,"<br/>\n")}}jQuery(this.jqId+"_comment").empty().append(g);jQuery(this.jqId+"_comment").height(this.rightPaneHeight-jQuery(this.jqId+"_info").height()-12);return this},removeComment:function(){jQuery(this.jqId+"_comment").empty();return this},redrawBoard:function(){var n=this;var l=this.gameState.board;var k="";if(this.config.gameType==jsGameViewer.DAOQI){for(var h=0;h<l.size;h++){for(var g=0;g<l.size;g++){var f=l[h][g];var m=0;if(this.config.showMoveNumber){m=this.gameState.getMoveNumber(h,g)}if(f==jsGameViewer.model.STONE_BLACK||f==jsGameViewer.model.STONE_WHITE){this.mapToPoints(h,g,function(o,p){k+=n.createStone(o,p,f,m)})}}}}else{for(var h=0;h<l.size;h++){for(var g=0;g<l.size;g++){var f=l[h][g];var m=0;if(this.config.showMoveNumber){m=this.gameState.getMoveNumber(h,g)}if(f==jsGameViewer.model.STONE_BLACK||f==jsGameViewer.model.STONE_WHITE){k+=this.createStone(h,g,f,m)}}}}jQuery(this.jqId+"_boardPoints").empty();if(k.length>0){jQuery(this.jqId+"_boardPoints").append(k)}return this},sendMove_:function(f,g){this.play(f,g);return this.sendMove()},play:function(f,o){if(this.gameState==null){return this}var n=this;if(this.gameState.board[f][o]!=0){if(this.gameState.isFirst()){return false}var k=new Array();var m=false;for(;;){var l=this.gameState.currentNode;if(l.type==jsGameViewer.model.NODE_MOVE&&l.x==f&&l.y==o){break}if(!this.back_(k)){break}m=true}if(m){jQuery.each(k,function(q,p){n.removeStone(p.x,p.y);if(p.deleteFlag){n.addStone(p.x,p.y,p.color)}});this.setGameState();return true}return false}if(!this.gameState.isLast()){var h=this.gameState.currentNode.children;for(var g=0;g<h.length;g++){var l=h[g];if(l.type==jsGameViewer.model.NODE_MOVE&&l.x==f&&l.y==o){return this.goToBranch(g)}}}if(this.gameState.play(f,o)){var l=this.gameState.currentNode;jQuery.each(l.points,function(q,p){n.removeStone(p.x,p.y);if(!p.deleteFlag){n.addStone(p.x,p.y,p.color)}});this.setGameState();return true}else{return false}},remove:function(){var g=this;if(this.gameState!=null&&this.gameState.canRemove()){var f=this.gameState.currentNode;jQuery.each(f.points,function(k,h){g.removeStone(h.x,h.y);if(h.deleteFlag){g.addStone(h.x,h.y,h.color)}});this.gameState.remove();this.setGameState()}return this},back_:function(k){if(this.gameState.isFirst()){return false}var l=this.gameState.currentNode;for(var h=0;h<l.points.length;h++){var f=l.points[h];var m=false;for(var g=0;g<k.length;g++){var n=k[g];if(f.x==n.x&&f.y==n.y){m=true;k[g]=f;break}}if(!m){k.push(f)}}this.gameState.back();return true},back:function(){if(this.gameState==null){return this}if(this.gameState.isFirst()){return false}var g=this;var f=this.gameState.currentNode;jQuery.each(f.points,function(k,h){g.removeStone(h.x,h.y);if(h.deleteFlag){g.addStone(h.x,h.y,h.color)}});this.gameState.back();this.setGameState();return true},backN:function(l){if(this.gameState==null){return this}var k=this;if(l==undefined){l=this.config.fastMode}var g=new Array();var h=false;for(var f=0;f<l;f++){if(!this.back_(g)){break}h=true}if(h){jQuery.each(g,function(n,m){k.removeStone(m.x,m.y);if(m.deleteFlag){k.addStone(m.x,m.y,m.color)}});this.setGameState()}return this},backToComment:function(){if(this.gameState==null){return this}var k=this;var f=new Array();var h=false;for(;;){if(!this.back_(f)){break}h=true;var g=this.gameState.currentNode;if(g.hasComment()||g.hasBranches()){break}}if(h){jQuery.each(f,function(m,l){k.removeStone(l.x,l.y);if(l.deleteFlag){k.addStone(l.x,l.y,l.color)}});this.setGameState()}return this},backAll:function(){if(this.gameState==null){return this}var g=this;this.removeAllStones();this.gameState.backAll();var f=this.gameState.currentNode;jQuery.each(f.points,function(k,h){if(h.color==jsGameViewer.model.STONE_BLACK||h.color==jsGameViewer.model.STONE_WHITE){g.addStone(h.x,h.y,h.color)}});this.setGameState();return this},forward_:function(k){if(this.gameState.isLast()){return false}this.gameState.forward();var l=this.gameState.currentNode;for(var h=0;h<l.points.length;h++){var f=l.points[h];var m=false;for(var g=0;g<k.length;g++){var n=k[g];if(f.x==n.x&&f.y==n.y){m=true;k[g]=f;break}}if(!m){k.push(f)}}return true},forward:function(){if(this.gameState==null){return this}if(!this.gameState.forward()){return false}var g=this;var f=this.gameState.currentNode;jQuery.each(f.points,function(k,h){g.removeStone(h.x,h.y);if(!h.deleteFlag){g.addStone(h.x,h.y,h.color)}});this.setGameState();return true},forwardN:function(l){if(this.gameState==null){return this}var k=this;if(l==undefined){l=this.config.fastMode}var g=new Array();var h=false;for(var f=0;f<l;f++){if(!this.forward_(g)){break}h=true}if(h){jQuery.each(g,function(n,m){k.removeStone(m.x,m.y);if(!m.deleteFlag){k.addStone(m.x,m.y,m.color)}});this.setGameState()}return this},forwardToComment:function(){if(this.gameState==null){return this}var k=this;var f=new Array();var h=false;for(;;){if(!this.forward_(f)){break}h=true;var g=this.gameState.currentNode;if(g.hasComment()||g.hasBranches()){break}}if(h){jQuery.each(f,function(m,l){k.removeStone(l.x,l.y);if(!l.deleteFlag){k.addStone(l.x,l.y,l.color)}});this.setGameState()}return this},forwardAll:function(){if(this.gameState==null){return this}this.removeAllStones();this.gameState.forwardAll();this.redrawBoard();this.setGameState();return this},goToBranch:function(h){if(this.gameState==null){return this}if(!this.gameState.goToBranch(h)){return this}var g=this;var f=this.gameState.currentNode;jQuery.each(f.points,function(l,k){g.removeStone(k.x,k.y);if(!k.deleteFlag){g.addStone(k.x,k.y,k.color)}});this.setGameState();return this},goTo:function(k){if(this.gameState==null){return this}var h=this;while(this.gameState.isOnBranch()){this.back()}if(k>=this.gameState.game.getMoves()){this.forwardAll()}else{if(k<=0){this.backAll()}else{if(k>this.gameState.currentNode.moveNumber){var f=new Array();var g=false;while(k>this.gameState.currentNode.moveNumber){if(!this.forward_(f)){break}g=true}if(g){jQuery.each(f,function(m,l){h.removeStone(l.x,l.y);if(!l.deleteFlag){h.addStone(l.x,l.y,l.color)}});this.setGameState()}}else{if(k<this.gameState.currentNode.moveNumber){var f=new Array();var g=false;while(k<this.gameState.currentNode.moveNumber){if(!this.back_(f)){break}g=true}if(g){jQuery.each(f,function(m,l){h.removeStone(l.x,l.y);if(l.deleteFlag){h.addStone(l.x,l.y,l.color)}});this.setGameState()}}}}}return this},setToggleNumberImg:function(){if(this.config.showMoveNumber){jQuery(this.jqId+"_toggleNumberImg").removeClass("gvsprite-hidenumber");jQuery(this.jqId+"_toggleNumberImg").addClass("gvsprite-shownumber")}else{jQuery(this.jqId+"_toggleNumberImg").removeClass("gvsprite-shownumber");jQuery(this.jqId+"_toggleNumberImg").addClass("gvsprite-hidenumber")}return this},toggleNumber:function(){if(this.config.showMoveNumber){this.config.showMoveNumber=false}else{this.config.showMoveNumber=true}this.setToggleNumberImg();if(this.gameState==null){return this}this.redrawBoard();return this},showNumber:function(){if(this.config.hideMoveNumber){this.toggleNumber()}return this},hideNumber:function(){if(this.config.showMoveNumber){this.toggleNumber()}return this},eventToXY:function(g){g=g.originalEvent||window.event;layerX=g.layerX||g.offsetX||g.clientX;layerY=g.layerY||g.offsetY||g.clientY;var f=parseInt(layerX/this.config.gridSize);var h=parseInt(layerY/this.config.gridSize);if(this.config.gameType==jsGameViewer.DAOQI){f=(f+this.config.boardSize-this.config.x0)%this.config.boardSize;h=(h+this.config.boardSize-this.config.y0)%this.config.boardSize}return[f,h]},isInCentralArea:function(f,g){return f>=this.config.vbw&&f<this.config.boardSize+this.config.vbw&&g>=this.config.vbw&&g<this.config.boardSize+this.config.vbw},xyToArea:function(f,g){return[f*this.config.gridSize,g*this.config.gridSize,this.config.gridSize,this.config.gridSize]},xyToLabel:function(f,h){var g=d[f];g+=this.config.boardSize-parseInt(h);return g},postThickBoxFix:function(){this.registerKeyListener()},goToPopup:function(){var f="#TB_inline?test=0&width=250&height=56&inlineId="+this.id+"_goTo&focus="+this.id+"_goToInput&modal=true&test1=0";tb_show("",f,null)},goToOkHandler:function(){try{var f=document.getElementsByName(this.id+"_goToForm")[1].goToInput.value;tb_remove();var g=parseInt(f);this.goTo(g)}catch(h){throw"GameController().goToOkHandler(): "+h}this.postThickBoxFix()},goToKeyDown:function(f,h){var g;if(window.event){g=window.event.keyCode}else{if(h){g=h.which}else{return}}if(g==13){gvGoToInput=f.value;this.goToOkHandler()}else{if(g==27){tb_remove();this.postThickBoxFix()}}}}}());