window.jsgv_zh_cn={move_number_after:"",back:"上一手",white:"白方",result:"结果",comment:"评论",trunk:"实战",fast_back:"快退",w:"白",submit:"执行",cancel:"取消",b:"黑",black:"黑方",komi:"贴目/子",whose_turn:"下一手",jump_to:"跳到第",time:"时间",handicap:"让子",moves:"手数",branch:"变化",refresh:"刷新棋谱内容",prev_comment_or_branch:"上一评论或变化图",forward:"下一手",end:"到棋局结束",black_dead:"黑被提",white_dead:"白被提",fast_forward:"快进",next_comment_or_branch:"下一评论或变化图",play_first:"先行",locale:"zh_cn",show_hide_move_number:"显示/隐藏手数",confirm_resign:"你确定要认输吗？",move_number_before:"",resign:"认输",open_in_new_window:"在新窗口打开",home:"到棋局开始",place:"地点",comment_for:"第MOVE手评论",branch_tag:"<变化>",error_thrown:"操作错误",jump_to_xx:"跳到第XX手",rule:"规则"};if(window.jsgvTranslations==undefined){window.jsgvTranslations=jsgv_zh_cn}window.jsgv_en_us={trunk:"Game move",comment:"Comment",result:"Result",white:"White",back:"Back",move_number_after:"",w:"W",fast_back:"Fast back",komi:"Komi",black:"Black",b:"B",cancel:"Cancel",submit:"OK",jump_to:"Jump to",whose_turn:"Next",branch:"Variation",moves:"Moves",handicap:"Handicap",time:"Time",end:"Forward to end",forward:"Forward",prev_comment_or_branch:"Previous comment or variation",refresh:"Refresh game/board",fast_forward:"Fast forward",white_dead:"W dead",black_dead:"B dead",play_first:"Play first",next_comment_or_branch:"Next comment or variation",confirm_resign:"Are you sure you want to resign?",show_hide_move_number:"Show/hide move number",locale:"en_us",error_thrown:"Error",branch_tag:"<Variation>",comment_for:"Comment for MOVE",place:"Place",home:"Back to beginning",open_in_new_window:"Open in new window",resign:"Resign",move_number_before:"",rule:"Rule",jump_to_xx:"Jump to XX"};if(window.jsgvTranslations==undefined){window.jsgvTranslations=jsgv_en_us}jQuery(document).ready(function(){tb_init("a.thickbox, area.thickbox, input.thickbox")});function tb_init(b){jQuery(b).click(function(){var f=this.title||this.name||null;var d=this.href||this.alt;var h=this.rel||false;tb_show(f,d,h);return false})}function tb_show(b,d,f){try{if(typeof document.body.style.maxHeight==="undefined"){jQuery("body","html").css({height:"100%",width:"100%"});jQuery("html").css("overflow","hidden");if(document.getElementById("TB_HideSelect")===null){jQuery("body").append("<iframe id='TB_HideSelect'></iframe><div id='TB_overlay'></div><div id='TB_window'></div>");jQuery("#TB_overlay").click(tb_remove)}}else{if(document.getElementById("TB_overlay")===null){jQuery("body").append("<div id='TB_overlay'></div><div id='TB_window'></div>");jQuery("#TB_overlay").click(tb_remove)}}if(tb_detectMacXFF()){jQuery("#TB_overlay").addClass("TB_overlayMacFFBGHack")}else{jQuery("#TB_overlay").addClass("TB_overlayBG")}if(b===null){b=""}var g;if(d.indexOf("?")!==-1){g=d.substr(0,d.indexOf("?"))}else{g=d}var k=d.replace(/^[^\?]+\??/,"");var i=tb_parseQuery(k);TB_WIDTH=(i.width*1)+30||630;TB_HEIGHT=(i.height*1)+40||440;ajaxContentW=TB_WIDTH-30;ajaxContentH=TB_HEIGHT-45;if(jQuery("#TB_window").css("display")!="block"){if(i.modal!="true"){jQuery("#TB_window").append("<div id='TB_title'><div id='TB_ajaxWindowTitle'>"+b+"</div><div id='TB_closeAjaxWindow'><a href='#' id='TB_closeWindowButton'>close</a> or Esc Key</div></div><div id='TB_ajaxContent' style='width:"+ajaxContentW+"px;height:"+ajaxContentH+"px'></div>")}else{jQuery("#TB_overlay").unbind();jQuery("#TB_window").append("<div id='TB_ajaxContent' class='TB_modal' style='width:"+ajaxContentW+"px;height:"+ajaxContentH+"px;'></div>")}}else{jQuery("#TB_ajaxContent")[0].style.width=ajaxContentW+"px";jQuery("#TB_ajaxContent")[0].style.height=ajaxContentH+"px";jQuery("#TB_ajaxContent")[0].scrollTop=0;jQuery("#TB_ajaxWindowTitle").html(b)}jQuery("#TB_closeWindowButton").click(tb_remove);jQuery("#TB_ajaxContent").html(jQuery("#"+i.inlineId).html());jQuery("#TB_window").unload(function(){jQuery("#"+i.inlineId).html(jQuery("#TB_ajaxContent").html())});tb_position();jQuery("#TB_load").remove();jQuery("#TB_window").css({display:"block"});document.onkeyup=function(l){if(l==null){keycode=event.keyCode}else{keycode=l.which}if(keycode==27){tb_remove()}};if(i.focus!=null){jQuery("#"+i.focus).focus()}}catch(h){}}function tb_remove(){jQuery("#TB_imageOff").unbind("click");jQuery("#TB_closeWindowButton").unbind("click");jQuery("#TB_window").fadeOut("fast",function(){jQuery("#TB_window,#TB_overlay,#TB_HideSelect").trigger("unload").unbind().remove()});jQuery("#TB_load").remove();if(typeof document.body.style.maxHeight=="undefined"){jQuery("body","html").css({height:"auto",width:"auto"});jQuery("html").css("overflow","")}document.onkeydown="";document.onkeyup="";return false}function tb_position(){jQuery("#TB_window").css({marginLeft:"-"+parseInt((TB_WIDTH/2),10)+"px",width:TB_WIDTH+"px"});if(!(jQuery.browser.msie&&jQuery.browser.version<7)){jQuery("#TB_window").css({marginTop:"-"+parseInt((TB_HEIGHT/2),10)+"px"})}}function tb_parseQuery(g){var h={};if(!g){return h}var b=g.split(/[;&]/);for(var f=0;f<b.length;f++){var l=b[f].split("=");if(!l||l.length!=2){continue}var d=unescape(l[0]);var k=unescape(l[1]);k=k.replace(/\+/g," ");h[d]=k}return h}function tb_getPageSize(){var f=document.documentElement;var b=window.innerWidth||self.innerWidth||(f&&f.clientWidth)||document.body.clientWidth;var d=window.innerHeight||self.innerHeight||(f&&f.clientHeight)||document.body.clientHeight;arrayPageSize=[b,d];return arrayPageSize}function tb_detectMacXFF(){var b=navigator.userAgent.toLowerCase();if(b.indexOf("mac")!=-1&&b.indexOf("firefox")!=-1){return true}}var jsGameViewer=function(){return{name:"jsgameviewer",version:"1.0a",length:0,WEIQI:0,DAOQI:1,EN_US:"en_us",ZH_CN:"zh_cn",LOCALES:["en_us","zh_cn"],CONFIG:{baseDir:"/jsgameviewer/",viewDir:"/jsgameviewer/view/",locale:jsgvTranslations.locale,gameType:0,boardSize:19,playerInterval:5,observerInterval:15,container:null},debug:function(b){if(typeof(console)!="undefined"){console.log(b)}},getGameId:function(b){if(b==undefined){this.length++;for(b=1;this["GV"+b]!=null;b++){}}return"GV"+b},createClass:function(){return function(){this.initialize.apply(this,arguments)}},clone:function(f){if(typeof(f)!="object"){return f}if(f==null){return f}var d=new Object();for(var b in f){d[b]=this.clone(f[b])}return d},notNull:function(b){return b!=undefined&&b!=null&&jQuery.trim(b).length>0},getId:function(b,d){return b+"-"+d},showAjaxError:function(f,d){var b=jsgvTranslations.error_thrown+"\n";if(f!=undefined){b+=f+" "}if(d!=undefined){b+=d}alert(b.substr(0,1000))}}}();var jsgv=jsGameViewer;jsGameViewer.model=function(){var v=0;var A=1;var t=2;var f=3;var C=0;var r=1;var p=2;var s=0;var E=1;var n=2;var z=0;var u=1;var h=2;var i=3;var y=4;var k=5;var b=6;var w=7;var l=8;var q=9;var m=jsGameViewer.createClass();jQuery.extend(m.prototype,{initialize:function(G,F){this.val=G;this.depth=0;if(F!=undefined&&F!=null){this.depth=F}}});var D=jsGameViewer.createClass();jQuery.extend(D.prototype,{initialize:function(F,J,G,H,I){this.x=F;this.y=J;this.id=F+"-"+J;this.color=0;if(G!=undefined&&G!=null){this.color=G}this.moveNumber=null;if(H!=undefined&&H!=null){this.moveNumber=H}this.deleteFlag=false;if(I){this.deleteFlag=true}}});var x=jsGameViewer.createClass();jQuery.extend(x,Array);jQuery.extend(x.prototype,{initialize:function(F,G){this.gameType=F;this.size=G;this.reset()},isNeighbor:function(G,I,F,H){if(this.gameType==jsGameViewer.DAOQI){if(G==F){return I==(H+1)%this.size||I==(H-1+this.size)%this.size}if(I==H){return G==(F+1)%this.size||G==(F-1+this.size)%this.size}return false}else{if(G==F){return I==H+1||I==H-1}if(I==H){return G==F+1||G==F-1}return false}},normalize:function(F){if(F<0){return F+this.size}if(F>=this.size){return F-this.size}return F},reset:function(){for(var F=0;F<this.size;F++){this[F]=new Array(this.size);for(j=0;j<this.size;j++){this[F][j]=0}}},copyFrom:function(F){for(var H=0;H<this.size;H++){for(var G=0;G<this.size;G++){this[H][G]=F[H][G]}}},getDeadGroup:function(F,H){if(this.gameType==jsGameViewer.DAOQI){F=this.normalize(F);H=this.normalize(H)}else{if(F<0||F>=this.size||H<0||H>=this.size){return null}}if(this[F][H]==0){return null}if(this.gameType==jsGameViewer.DAOQI){if(this[this.normalize(F-1)][H]==0||this[this.normalize(F+1)][H]==0||this[F][this.normalize(H-1)]==0||this[F][this.normalize(H+1)]==0){return null}}else{if((F>0&&this[F-1][H]==0)||(F<this.size-1&&this[F+1][H]==0)||(H>0&&this[F][H-1]==0)||(H<this.size-1&&this[F][H+1]==0)){return null}}var G=new Array();G.color=this[F][H];G.push([F,H]);G[F+"-"+H]=true;if(this.gameType==jsGameViewer.DAOQI){if(this.expandDeadGroup(G,F-1,H)){return null}if(this.expandDeadGroup(G,F+1,H)){return null}if(this.expandDeadGroup(G,F,H-1)){return null}if(this.expandDeadGroup(G,F,H+1)){return null}}else{if(F>0&&this.expandDeadGroup(G,F-1,H)){return null}if(F<this.size-1&&this.expandDeadGroup(G,F+1,H)){return null}if(H>0&&this.expandDeadGroup(G,F,H-1)){return null}if(H<this.size-1&&this.expandDeadGroup(G,F,H+1)){return null}}return G},expandDeadGroup:function(G,F,H){if(this.gameType==jsGameViewer.DAOQI){F=this.normalize(F);H=this.normalize(H)}if(G[F+"-"+H]!=null){return false}if(this[F][H]!=G.color){return false}if(this.gameType==jsGameViewer.DAOQI){if(this[this.normalize(F-1)][H]==0||this[this.normalize(F+1)][H]==0||this[F][this.normalize(H-1)]==0||this[F][this.normalize(H+1)]==0){return true}}else{if((F>0&&this[F-1][H]==0)||(F<this.size-1&&this[F+1][H]==0)||(H>0&&this[F][H-1]==0)||(H<this.size-1&&this[F][H+1]==0)){return true}}G.push([F,H]);G[F+"-"+H]=true;if(this.gameType==jsGameViewer.DAOQI){if(this.expandDeadGroup(G,F-1,H)){return true}if(this.expandDeadGroup(G,F+1,H)){return true}if(this.expandDeadGroup(G,F,H-1)){return true}if(this.expandDeadGroup(G,F,H+1)){return true}}else{if(F>0&&this.expandDeadGroup(G,F-1,H)){return true}if(F<this.size-1&&this.expandDeadGroup(G,F+1,H)){return true}if(H>0&&this.expandDeadGroup(G,F,H-1)){return true}if(H<this.size-1&&this.expandDeadGroup(G,F,H+1)){return true}}return false}});var B=jsGameViewer.createClass();jQuery.extend(B.prototype,{initialize:function(F){this.type=s;this.parent=F;this.children=new Array();this.moveNumber=0;this.depth=0;this.points=new Array();this.processed=false;this.blackPrisoners=0;this.blackPrisonerPoints=[];this.whitePrisoners=0;this.whitePrisonerPoints=[]},isRoot:function(){return this.parent==null},hasChildren:function(){return this.children.length>0},firstChild:function(){if(this.children.length>0){return this.children[0]}return null},childThatMatches:function(F,I){for(var G=0;G<this.children.length;G++){var H=this.children[G];if(H.x==F&&H.y==I){return G}}return null},isOnBranch:function(){return this.depth>1},isDummyNode:function(){return this.type==s&&!this.isRoot()&&this.comment==null&&this.marks==null},hasComment:function(){return this.comment!=undefined&&this.comment!=null&&jQuery.trim(this.comment).length>0},hasBranches:function(){return this.children.length>1},toString:function(){var F="";var G="EMPTY";if(this.type==E){G="MOVE"}else{if(this.type==n){G="PASS"}}var H=F+"Node("+G+", "+this.moveNumber;if(this.type==E||this.type==n){H+=", "+(this.color==A?"black":"white")}if(this.type==E){H+=", "+this.x+","+this.y}H+=")";return H}});var g=jsGameViewer.createClass();jQuery.extend(g.prototype,{initialize:function(F){this.type=F;this.charset="";this.name="";this.boardSize=19;this.rule="";this.handicap=0;this.komi=0;this.blackName="";this.blackRank="";this.whiteName="";this.whiteRank="";this.date="";this.place="";this.result="";this._moves=0;this.rootNode=new B(null)},isFinished:function(){return this.result&&this.result.length>0},getMoves:function(){if(this._moves==0){var F=this.rootNode;while(F.hasChildren()){F=F.children[0];if(F.moveNumber!=undefined&&F.moveNumber!=null){this._moves=F.moveNumber}}}return this._moves},getFirstPlayer:function(){if(!this.firstPlayer){if(this.handicap>1){this.firstPlayer=t}else{var F=this.rootNode;while(this.firstPlayer==v&&F.hasChildren()){F=F.children[0];if(F.type==E||F.type==n){this.firstPlayer=F.color}}}}return this.firstPlayer},getId:function(){var F=this.url;return F},getTitle:function(){var F="";if(this.name){F+=this.name+": "}if(this.whiteName){F+=this.whiteName}else{F+="Unknown Player"}F+="(W) - ";if(c.game.blackName){F+=c.game.blackName}else{F+="Unknown Player"}F+="(B)";if(this.result){F+="   "+this.result}if(this.date){F+="   "+this.date}if(this.place){F+="   "+this.place}return F}});var o=jsGameViewer.createClass();jQuery.extend(o.prototype,{initialize:function(F){this.game=F;this.board=new x(F.type,F.boardSize);this.currentNode=F.rootNode;this.rootNode=this.currentNode;this.blackPrisoners=0;this.blackPrisonerPoints=[];this.whitePrisoners=0;this.whitePrisonerPoints=[];this.moveNumbers=new Object();this.tempMoves=new Array();this.processCurrentNode()},isFirst:function(){return this.currentNode.isRoot()},isLast:function(){return !this.currentNode.hasChildren()},isOnBranch:function(){return this.currentNode.isOnBranch()},getXYs:function(){var F=this.currentNode;var G=[];while(F){if(F.type==E){G.unshift([F.x,F.y])}F=F.parent}return G},getNextPlayer:function(){if(this.currentNode==this.rootNode){return this.game.getFirstPlayer()}var G=this.currentNode;var F=G.color;while(F!=A&&F!=t&&!G.isRoot()){G=G.parent;F=G.color}if(F==A){F=t}else{if(F==t){F=A}else{G=this.currentNode;while(F!=A&&F!=t&&G.hasChildren()){G=G.children[0];F=G.color}}}if(!F||F==v){F=A}return F},getMoveNumber:function(G,H){var F=this.moveNumbers[jsGameViewer.getId(G,H)];if(F instanceof Number){return F}if(F!=undefined&&F!=null){return F.val}return 0},handleDeadGroup:function(G){var F=this;if(G!=null){if(G.color==A){F.currentNode.blackPrisoners+=G.length;F.blackPrisoners+=G.length}else{F.currentNode.whitePrisoners+=G.length;F.whitePrisoners+=G.length}jQuery.each(G,function(J,L){var I=L[0],N=L[1],K=F.moveNumbers[jsGameViewer.getId(I,N)];var M=[I,N,G.color,K,F.currentNode.moveNumber];if(G.color==A){F.currentNode.blackPrisonerPoints.push(M);F.blackPrisonerPoints.push(M)}else{F.currentNode.whitePrisonerPoints.push(M);F.whitePrisonerPoints.push(M)}F.board[I][N]=0;var H=new D(I,N,G.color,K,true);F.currentNode.points.push(H);delete F.moveNumbers[jsGameViewer.getId(I,N)]})}},processCurrentNode:function(){var G=this;var L=this.board;var H=this.currentNode;if(H.processed){for(var J=0;J<H.points.length;J++){var P=H.points[J];if(P.deleteFlag){L[P.x][P.y]=0}else{L[P.x][P.y]=P.color}this.moveNumbers[jsGameViewer.getId(P.x,P.y)]=P.moveNumber}if(H.blackPrisoners>0){this.blackPrisoners+=H.blackPrisoners;this.blackPrisonerPoints=this.blackPrisonerPoints.concat(H.blackPrisonerPoints)}if(H.whitePrisoners>0){this.whitePrisoners+=H.whitePrisoners;this.whitePrisonerPoints=this.whitePrisonerPoints.concat(H.whitePrisonerPoints)}return}H.processed=true;switch(H.type){case s:jQuery.each(H.points,function(V,T){var S=T.x,X=T.y,U=T.color;if(S<0||S>=L.size||X<0||X>=L.size){return}switch(U){case f:T.color=L[S][X];T.deleteFlag=true;var W=[S,X,T.color,G.moveNumbers[jsGameViewer.getId(S,X)],H.moveNumber];if(T.color==A){H.blackPrisoners++;G.blackPrisoners++;H.blackPrisonerPoints.push(W);G.blackPrisonerPoints.push(W)}else{if(T.color==t){H.whitePrisoners++;G.whitePrisoners++;H.whitePrisonerPoints.push(W);G.whitePrisonerPoints.push(W)}}L[S][X]=0;break;case A:case t:L[S][X]=U;break}});break;case E:var O=H.x,M=H.y,I=H.color,R=this.game.boardSize;if(O<0||O>=R||M<0||M>=R){throw"Invalid point: ("+O+","+M+")"}L[O][M]=I;var Q=new m(H.moveNumber,H.depth);G.moveNumbers[jsGameViewer.getId(O,M)]=Q;var P=new D(O,M,I,Q);H.points.push(P);var K=(I==A)?t:A;if(G.game.type==jsGameViewer.DAOQI){var F=L.normalize(O-1);var N=M;if(L[F][N]==K){this.handleDeadGroup(L.getDeadGroup(F,N))}F=L.normalize(O+1);N=M;if(L[F][N]==K){this.handleDeadGroup(L.getDeadGroup(F,N))}F=O;N=L.normalize(M-1);if(L[F][N]==K){this.handleDeadGroup(L.getDeadGroup(F,N))}F=O;N=L.normalize(M+1);if(L[F][N]==K){this.handleDeadGroup(L.getDeadGroup(F,N))}}else{if(O>0){var F=O-1,N=M;if(L[F][N]==K){this.handleDeadGroup(L.getDeadGroup(F,N))}}if(O<L.size-1){var F=O+1,N=M;if(L[F][N]==K){this.handleDeadGroup(L.getDeadGroup(F,N))}}if(M>0){var F=O,N=M-1;if(L[F][N]==K){this.handleDeadGroup(L.getDeadGroup(F,N))}}if(M<L.size-1){var F=O,N=M+1;if(L[F][N]==K){this.handleDeadGroup(L.getDeadGroup(F,N))}}}this.handleDeadGroup(L.getDeadGroup(O,M));break;case n:break}if(!H.hasChildren()){if(!H.isOnBranch()&&this.last==null){G.last=new Object();G.last.node=H;G.last.board=jsGameViewer.clone(L);G.last.moveNumbers=jsGameViewer.clone(this.moveNumbers);G.last.blackPrisoners=this.blackPrisoners;G.last.blackPrisonerPoints=jsGameViewer.clone(this.blackPrisonerPoints);G.last.whitePrisoners=this.whitePrisoners;G.last.whitePrisonerPoints=jsGameViewer.clone(this.whitePrisonerPoints)}}},play:function(L,K){var I=this.board;if(L<0||L>=I.size||K<0||K>=I.size){return false}if(I[L][K]!=0){return false}var J=this.getNextPlayer();var G=(J==A)?t:A;I[L][K]=J;var H=0;if(L>0&&I[L-1][K]==G){var N=I.getDeadGroup(L-1,K);if(N!=null){H=N.length}}if(H<2&&L<I.size-1&&I[L+1][K]==G){var N=I.getDeadGroup(L+1,K);if(N!=null){H=+N.length}}if(H<2&&K>0&&I[L][K-1]==G){var N=I.getDeadGroup(L,K-1);if(N!=null){H=+N.length}}if(H<2&&K<I.size-1&&I[L][K+1]==G){var N=I.getDeadGroup(L,K+1);if(N!=null){H=+N.length}}var F=true;if(H==1){if(this.currentNode.type==E){if(I.isNeighbor(L,K,this.currentNode.x,this.currentNode.y)&&(this.currentNode.blackPrisoners==1||this.currentNode.whitePrisoners==1)){F=false}}}else{if(H==0){var N=I.getDeadGroup(L,K);if(N!=null&&N.length>0){F=false}}}if(!F){I[L][K]=0;return false}var M=new B(this.currentNode);M.temp=true;M.type=E;M.x=L;M.y=K;M.color=J;M.moveNumber=this.currentNode.moveNumber+1;if(this.currentNode.children.length==0){M.depth=this.currentNode.depth}else{M.depth=this.currentNode.depth+1}if(!M.isOnBranch()){this.last=null}this.currentNode.children.push(M);this.tempMoves.push([L,K]);return this.goToBranch(this.currentNode.children.length-1)},canRemove:function(){if(this.currentNode.temp){return true}else{return false}},remove:function(){if(this.canRemove()){var H=this.currentNode;var G=H.parent;var F=0;for(F=0;F<G.children.length;F++){if(G.children[F]==H){break}}this.back();G.children.splice(F,1);if(!H.isOnBranch()){this.last=null}}},back:function(){if(this.currentNode.isRoot()){return false}for(var G=0;G<this.currentNode.points.length;G++){var F=this.currentNode.points[G];if(F.deleteFlag){this.board[F.x][F.y]=F.color;this.moveNumbers[jsGameViewer.getId(F.x,F.y)]=F.moveNumber}else{this.board[F.x][F.y]=v;delete this.moveNumbers[jsGameViewer.getId(F.x,F.y)]}}if(this.currentNode.blackPrisoners>0){this.blackPrisoners-=this.currentNode.blackPrisoners;for(var G=0;G<this.currentNode.blackPrisoners;G++){if(this.blackPrisonerPoints.length>0){this.blackPrisonerPoints.pop()}}}if(this.currentNode.whitePrisoners>0){this.whitePrisoners-=this.currentNode.whitePrisoners;for(var G=0;G<this.currentNode.whitePrisoners;G++){if(this.whitePrisonerPoints.length>0){this.whitePrisonerPoints.pop()}}}this.currentNode=this.currentNode.parent;return true},backAll:function(){this.currentNode=this.rootNode;this.board.reset();this.moveNumbers=new Object();this.blackPrisoners=0;this.blackPrisonerPoints=[];this.whitePrisoners=0;this.whitePrisonerPoints=[];var F=this.board;jQuery.each(this.currentNode.points,function(H,G){F[G.x][G.y]=G.color})},forward:function(){if(!this.currentNode.hasChildren()){return false}this.currentNode=this.currentNode.children[0];this.processCurrentNode();return true},forwardAll:function(){if(this.isOnBranch()||this.last==null){while(this.forward()){}}else{this.currentNode=this.last.node;this.board.copyFrom(this.last.board);this.moveNumbers=jsGameViewer.clone(this.last.moveNumbers);this.blackPrisoners=this.last.blackPrisoners;this.blackPrisonerPoints=jsGameViewer.clone(this.last.blackPrisonerPoints);this.whitePrisoners=this.last.whitePrisoners;this.whitePrisonerPoints=jsGameViewer.clone(this.last.whitePrisonerPoints)}},goToBranch:function(F){if(!this.currentNode.hasChildren()){return false}if(this.currentNode.children.length<=F){return false}this.currentNode=this.currentNode.children[F];this.processCurrentNode();return true}});var d=new Array();jQuery.extend(d,{max:30,save:function(H){var J=H.game.getId();var F=null;for(var G=0;G<this.length;G++){if(this[G]==J){F=G;break}}if(F!=null&&F>0){for(var G=0;G<F-1;G++){this[G+1]=this[G]}}else{this.unshift(J);if(this.length>this.max){var I=this.pop();delete this[I]}}this[0]=J;this[J]=H}});return{STONE_NONE:v,STONE_BLACK:A,STONE_WHITE:t,STONE_ERASE:f,MODE_NORMAL:C,MODE_EDIT:r,MODE_SCORE:p,NODE_EMPTY:s,NODE_MOVE:E,NODE_PASS:n,MARK_NONE:z,MARK_SQUARE:u,MARK_CIRCLE:h,MARK_TRIANGLE:i,MARK_CROSS:y,MARK_TEXT:k,MARK_NUMBER:b,MARK_TERR_BLACK:w,MARK_TERR_WHITE:l,MARK_STONE:q,MoveNumber:m,Point:D,Board:x,Game:g,GameState:o,Node:B,GameHistory:d}}();jsGameViewer.SGFParser=jsGameViewer.createClass();jsGameViewer.SGFParser.prototype=function(){var J=jsGameViewer.WEIQI;var m=jsGameViewer.model.Game;var r=jsGameViewer.model.Node;var p=jsGameViewer.model.Point;var D=jsGameViewer.model.STONE_NONE;var z=jsGameViewer.model.STONE_BLACK;var H=jsGameViewer.model.STONE_WHITE;var I=jsGameViewer.model.NODE_MOVE;var y=jsGameViewer.model.NODE_PASS;var x=97;var b=0;var K=1;var k=2;var d=0;var l=1;var E=2;var N=3;var i=4;var A=5;var M=6;var L=7;var s=0;var w=1;var G=2;var C=3;var g=4;var B=5;var n=6;var u=7;var t="10";function f(P){this.gameType=P}function O(S,R,P){var Q;if(S!=-1){Q=S}else{if(R!=-1){Q=R}else{Q=P}}if(S<Q&&S!=-1){Q=S}if(R<Q&&R!=-1){Q=R}if(P<Q&&P!=-1){Q=P}return Q}function v(P,Q){while(true){c=P.charAt(Q);if(c==" "||c=="\t"||c=="\n"||c=="\r"){Q++}else{break}}return Q}function q(P,S,R){var Q="SGFParser: ";if(S>0){Q+=P.substring(0,S-1)}Q+="{PARSING FAILED HERE: ";if(R!=undefined&&R!=null){Q+=R}Q+="}";if(S<P.length){Q+=P.substring(S)}return Q}function F(R,T){var S;var Q=R.length;var P="";S=R.indexOf(T+"[");if(S==-1){return P}S+=2;if(R.charAt(S)!="["){throw q(R,S)}while(R.charAt(++S)!="]"&&S<Q){P+=R.charAt(S)}if(S>Q){throw q(R,S)}return P}function h(Q){var P=new m(this.gameType);R=F(Q,"GM");if(R.length>0&&t==R){P.type=DAOQI}var R=F(Q,"SZ");if(R.length>0){try{P.boardSize=parseInt(R)}catch(S){throw q(Q,Q.indexOf("SZ["))}}R=F(Q,"GN");if(R.length>0){P.name=R}R=F(Q,"CA");if(R.length>0){P.charset=R}R=F(Q,"PW");if(R.length>0){P.whiteName=R}R=F(Q,"WR");if(R.length>0){P.whiteRank=R}R=F(Q,"PB");if(R.length>0){P.blackName=R}R=F(Q,"BR");if(R.length>0){P.blackRank=R}R=F(Q,"RU");if(R.length>0){P.rule=R}R=F(Q,"KM");if(R.length>0){try{P.komi=parseFloat(R)}catch(S){throw q(Q,Q.indexOf("KM["))}}R=F(Q,"HA");if(R.length>0){try{P.handicap=parseInt(R)}catch(S){throw q(Q,Q.indexOf("HA["))}}R=F(Q,"RE");if(R.length>0){P.result=R}R=F(Q,"DT");if(R.length>0){P.date=R}R=F(Q,"PC");if(R.length>0){P.place=R}return P}function o(ab){var X=0;try{ab=ab.replace(/&/g,"&amp;");ab=ab.replace(/</g,"&lt;");var ao=h(ab);var T=ab.length;var V=b;var X=0;var P=0;var ae=0;var W=0;var ag=0;var ai=true;var am=0;var Z=-1;var Y=-1;var ah=D;var ad=false;var Q="";var ac=s;var an="";var U=ao.rootNode;var aj=new Array();do{P=ab.indexOf("(",ag);ae=ab.indexOf(")",ag);W=ab.indexOf(";",ag);X=O(P,ae,W);if(V==K&&X==ae){V=k}if(V==K&&X==P){V=b}else{if(V==b&&X==W){V=K}else{if(V==k&&X==P){V=b}}}switch(V){case b:if(X!=P){throw q(ab,X)}aj.push(U);ag=X+1;break;case k:if(X!=ae){throw q(ab,X)}U=aj.pop();am=U.moveNumber;ag=X+1;break;case K:if(X!=W){throw q(ab,X)}if(ai){ai=false}else{if(U.isDummyNode()&&U.parent!=null){U.parent.children.pop();U=U.parent}var R=new r(U);R.moveNumber=am;if(aj.length>0){R.depth=aj[aj.length-1].depth+1}U.children.push(R);U=R}var S;X++;do{var aa=0;X=v(ab,X);if(ab.charAt(X)=="B"&&ab.charAt(aa=v(ab,X+1))=="["){S=d;X=aa;ah=z}else{if(ab.charAt(X)=="W"&&ab.charAt(aa=v(ab,X+1))=="["){S=l;X=aa;ah=H}else{if(ab.charAt(X)=="A"&&ab.charAt(X+1)=="B"&&ab.charAt(aa=v(ab,X+2))=="["){S=E;X=aa;ad=true;ah=z}else{if(ab.charAt(X)=="A"&&ab.charAt(X+1)=="W"&&ab.charAt(aa=v(ab,X+2))=="["){S=N;X=aa;ad=true;ah=H}else{if(ab.charAt(X)=="A"&&ab.charAt(X+1)=="E"&&ab.charAt(aa=v(ab,X+2))=="["){S=i;X=aa;ad=true;ah=STONE_ERASE}else{if(ab.charAt(X)=="T"&&ab.charAt(X+1)=="R"&&ab.charAt(aa=v(ab,X+2))=="["){S=M;ac=G;X=aa}else{if(ab.charAt(X)=="C"&&ab.charAt(X+1)=="R"&&ab.charAt(aa=v(ab,X+2))=="["){S=M;ac=g;X=aa}else{if(ab.charAt(X)=="S"&&ab.charAt(X+1)=="Q"&&ab.charAt(aa=v(ab,X+2))=="["){S=M;ac=C;X=aa}else{if(ab.charAt(X)=="M"&&ab.charAt(X+1)=="A"&&ab.charAt(aa=v(ab,X+2))=="["){S=M;ac=w;X=aa}else{if(ab.charAt(X)=="L"&&ab.charAt(X+1)=="B"&&ab.charAt(aa=v(ab,X+2))=="["){S=M;ac=B;X=aa;oldLabel=false}else{if(ab.charAt(X)=="C"&&ab.charAt(aa=v(ab,X+1))=="["){S=A;X=aa}else{if(ab.charAt(X)=="N"&&ab.charAt(aa=v(ab,X+1))=="["){S=L;X=aa}else{if(ab.charAt(X)=="T"&&ab.charAt(X+1)=="B"&&ab.charAt(aa=v(ab,X+2))=="["){S=M;ac=n;X=aa;ah=z}else{if(ab.charAt(X)=="T"&&ab.charAt(X+1)=="W"&&ab.charAt(aa=v(ab,X+2))=="["){S=M;ac=u;X=aa;ah=H}else{if(ab.charAt(X)==";"||ab.charAt(X)=="("||ab.charAt(X)==")"){X=v(ab,X);continue}else{var al=ab.indexOf("]",X)+1;if(al<=0){ag=X+1;break}X=al;X=v(ab,X);continue}}}}}}}}}}}}}}}do{if(ab.charAt(X)!="["){throw q(ab,X)}if(ab.charAt(X+1)=="]"){if(S==d||S==l){U.type=y;U.color=ah;U.moveNumber=++am}X+=2;continue}switch(S){case d:case l:Z=ab.charCodeAt(X+1)-x;Y=ab.charCodeAt(X+2)-x;U.type=I;if(Z>=19||Y>=19){U.type=y}U.color=ah;U.x=Z;U.y=Y;U.moveNumber=++am;X+=4;break;case E:case N:case i:Z=ab.charCodeAt(X+1)-x;Y=ab.charCodeAt(X+2)-x;U.points.push(new p(Z,Y,ah));X+=4;break;case A:if(U.comment==null){U.comment=""}while(ab.charAt(++X)!="]"||(ab.charAt(X-1)=="\\"&&ab.charAt(X)=="]")){if(!(ab.charAt(X)=="\\"&&ab.charAt(X+1)=="]")&&!(ab.charAt(X)=="\\"&&ab.charAt(X+1)=="[")&&!(ab.charAt(X)=="\\"&&ab.charAt(X+1)==")")&&!(ab.charAt(X)=="\\"&&ab.charAt(X+1)=="(")){U.comment+=ab.charAt(X)}if(X>T){throw q(ab,T)}}X++;break;case L:U.name="";while(ab.charAt(++X)!="]"){U.name+=ab.charAt(X)}X++;break;case M:while(ab.charAt(X)=="["&&X<T){Z=ab.charCodeAt(X+1)-x;Y=ab.charCodeAt(X+2)-x;X+=3;an="";if(ac==B){if(ab.charAt(X)!=":"){throw q(ab,X)}while(ab.charAt(++X)!="]"&&X<T){an+=ab.charAt(X)}try{var af=parseInt(an);ac=B}catch(ak){ac=B}}if(U.marks==null){U.marks=new Array()}U.marks.push([Z,Y,ac,an]);X++;X=v(ab,X)}break}X=v(ab,X)}while(ad&&ab.charAt(X)=="[");X=v(ab,X)}while(ab.charAt(X)!=";"&&ab.charAt(X)!="("&&ab.charAt(X)!=")"&&X<T);X=v(ab,X);ag=X;break;default:throw q(ab,ag)}}while(ag<T&&X>=0);if(U.isDummyNode()&&U.parent!=null){U.parent.children.pop()}return ao}catch(ak){throw q(ab,X,ak)}}return{initialize:f,parse:o}}();jsGameViewer.GameController=jsGameViewer.createClass();jQuery.extend(jsGameViewer.GameController.prototype,{initialize:function(b){this.id=jsGameViewer.getGameId();this.jqId="#"+this.id;jsGameViewer[this.id]=this;this.config=jsGameViewer.clone(jsGameViewer.CONFIG);if(b!=null){jQuery.extend(this.config,b)}this.reset()},init:function(){this.initView();this._initialized=true;return this},initialized:function(){return this._inialized==true},changeLocale:function(b){if(this.config.locale==b){return this}if(!jsGameViewer.LOCALES.indexOf(b)<0){alert("jsGameViewer WARNING: Invalid locale '"+b+"'");return this}this.config.locale=b;window.jsgvTranslations=window["jsgv_"+b];jsGameViewer.WEIQI_TEMPLATE=null;jsGameViewer.DAOQI_TEMPLATE=null;this.reset();this.show();if(this.gameState){this.gameState.backAll();this.initGame()}return this},destroy:function(){this.destroyView();delete jsGameViewer[this.id];jsGameViewer.length--},reset:function(){this._initialized=false;if(this.config.container!=null){var b=jQuery("#"+this.config.container);if(b.get(0).nodeName=="DIV"){b.empty().append(this.getPlaceHolder())}else{if(jQuery(this.jqId).get(0)){jQuery(this.jqId).replaceWith(this.getPlaceHolder())}else{b.after(this.getPlaceHolder())}}}else{if(jQuery(this.jqId).get(0)!=null){jQuery(this.jqId).replaceWith(this.getPlaceHolder())}else{document.write(this.getPlaceHolder())}}return this},show:function(){if(!this.initialized()){this.init()}jQuery(this.jqId).show();return this},hide:function(){jQuery(this.jqId).hide();return this},setGameType:function(b){if(this.config.gameType!=b){this.config.gameType=b;this.reset()}return this},setGameTypeIf:function(b){if(this.config.gameType!=jsGameViewer.DAOQI&&this.game.type==jsGameViewer.DAOQI){this.setGameType(jsGameViewer.DAOQI)}return this},load:function(b,g){var d=jsGameViewer.model.GameHistory[b];if(d){jsGameViewer.model.GameHistory.save(d);this.game=d.game;this.setGameTypeIf(this.game.type).show();this.gameState=d;this.gameState.backAll();this.initGame();if(g==undefined){this.forwardAll()}else{this.forwardN(g)}return this}var f=this;jQuery.ajax({url:b,success:function(h){try{if(f.game&&f.game.dataSize&&f.game.dataSize==h.length){return}f.game=new jsGameViewer.SGFParser(f.config.gameType).parse(h);f.game.dataSize=h.length;f.setGameTypeIf(f.game.type).show();f.game.url=b;f.gameState=new jsGameViewer.model.GameState(f.game);jsGameViewer.model.GameHistory.save(f.gameState);f.initGame();if(g==undefined){f.forwardAll()}else{f.forwardN(g)}}catch(i){throw"GameController.load('"+b+"')->success: "+i}},failure:function(){throw"GameController.load('"+b+"')->failure:"}});return this},loadSgf:function(b,f){try{b=jQuery.trim(b);this.show();this.game=new jsGameViewer.SGFParser(this.config.gameType).parse(b);this.game.dataSize=b.length;this.setGameTypeIf(this.game.type);this.gameState=new jsGameViewer.model.GameState(this.game);this.initGame();if(f==undefined){this.forwardAll()}else{this.forwardN(f)}return this}catch(d){throw"GameController.loadSgf('"+b+"'): "+d}},loadInline:function(b,f){try{if(jQuery("#"+b).length==0){return this}loadSgf(jQuery("#"+b).text(),f);return this}catch(d){throw"GameController.loadInline('"+b+"'): "+d}},refresh:function(d){var b=this.game.url;var f=this;jQuery.ajax({url:b,success:function(g){try{g=jQuery.trim(g);jsgv.debug("refresh 1");if(!d&&f.game&&f.game.dataSize&&f.game.dataSize==g.length){return}jsgv.debug("refresh 2");f.game=new jsGameViewer.SGFParser(f.config.gameType).parse(g);f.game.dataSize=g.length;f.setGameTypeIf(f.game.type).show();f.game.url=b;f.gameState=new jsGameViewer.model.GameState(f.game);jsGameViewer.model.GameHistory.save(f.gameState);f.initGame();f.forwardAll()}catch(h){throw"GameController.refresh('"+b+"')->success: "+h}},failure:function(){throw"GameController.refresh('"+b+"')->failure:"}})},openInWindow:function(){var d=this.config.baseDir+"/php/game_window.php?";var h="jsgameviewer",f=722,b=452;if(this.config.gameType==jsGameViewer.DAOQI){d+="type=DAOQI&";f=798;b=528}if(this.game&&this.game.url){d+="url="+encodeURIComponent(this.game.url)}var g=window.open(d,h,"width="+f+"px,height="+b+"px,status=yes,location=no,resizable=yes")},getPlaceHolder:function(){return"<div id='"+this.id+"' style='display:none'>&nbsp;</div>"}});var GameController=jsGameViewer.GameController;jQuery.extend(jsGameViewer.GameController.prototype,{setPlayerInterval:function(b){this.config.playerInterval=b;return this},setObserverInterval:function(b){this.config.observerInterval=b;return this},startUpdater:function(f){this.stopUpdater();if(this.game&&this.game.isFinished()){return this}var g=this;var d=function(){if(!g.game){return}if(g.game.isFinished()){g.stopUpdater();return}if(!f&&g.isMyTurn()){return}g.refresh()};var b=this.config.observerInterval;if(this.player){b=this.config.playerInterval}this.updater=setInterval(d,b*1000);return this},stopUpdater:function(){if(this.updater){clearInterval(this.updater);delete this.updater}return this}});jQuery.extend(jsGameViewer.CONFIG,{gridSize:21,fastMode:10,showMoveNumber:false,activeBackground:"#EECD7A",inactiveBackground:"#CCAB69",boardColor:"#EECD7A",gridSizeWQ:21,gridSizeDQ:19,boardColorDQ:"#CCAB69",vbw:4,boardSizeDQ:27,rightPaneHeight:446,rightPaneHeightDQ:560});jQuery.extend(jsGameViewer.GameController.prototype,function(){var d=["A","B","C","D","E","F","G","H","J","K","L","M","N","O","P","Q","R","S","T"];var b=["A","B","C","D","E","F","G","H","I","J"];return{destroyView:function(){jQuery(this.jqId).remove()},getTemplateLocation:function(){var f=this.config.gameType==jsGameViewer.DAOQI?"daoqi":"weiqi";return this.config.viewDir+"templates/"+f+"_"+this.config.locale+".html"},initView:function(){if(this.initialized()){return this}this.config.x0=this.config.vbw;this.config.y0=this.config.vbw;var k="";if(this.config.gameType==jsGameViewer.DAOQI){this.config.gridSize=this.config.gridSizeDQ;if(jsGameViewer.DAOQI_TEMPLATE==null){jQuery.ajax({async:false,dataType:"application/xml",url:this.getTemplateLocation(),success:function(m){jsGameViewer.DAOQI_TEMPLATE=m}})}k=jsGameViewer.DAOQI_TEMPLATE;this.rightPaneHeight=this.config.rightPaneHeightDQ}else{this.config.gridSize=this.config.gridSizeWQ;if(jsGameViewer.WEIQI_TEMPLATE==null){jQuery.ajax({async:false,dataType:"application/xml",url:this.getTemplateLocation(),success:function(m){jsGameViewer.WEIQI_TEMPLATE=m}})}k=jsGameViewer.WEIQI_TEMPLATE;this.rightPaneHeight=this.config.rightPaneHeight}if(this.id!="GV1"){k=k.replace(/GV1/g,this.id)}jQuery(this.jqId).replaceWith(k);var l=this;var h=function(n){l.registerKeyListener();var m=l.eventToXY(n);l.toX=m[0];l.toY=m[1];jQuery(l.jqId+"_pointLabel").empty().append(l.xyToLabel(m[0],m[1]));return false};var i=function(m){jQuery(l.jqId+"_pointLabel").empty();return false};var g=function(n){var m=l.eventToXY(n);if(l.config.gameType==jsGameViewer.DAOQI){l.fromX=l.toX=m[0];l.fromY=l.toY=m[1];jQuery(this).css("cursor","move");jsgv.debug("fromX: "+l.fromX+", fromY: "+l.fromY)}else{l.play(m[0],m[1])}jQuery(this).one("mouseup",f);return false};var f=function(m){jQuery(this).unbind("mouseup");if(!(l.config.gameType==jsGameViewer.DAOQI)){return false}jQuery(this).css("cursor","auto");if(l.fromX==undefined||l.fromX==NaN||l.fromY==undefined||l.fromY==NaN){return}if(l.fromX!=l.toX||l.fromY!=l.toY){l.moveBoard(l.toX-l.fromX,l.toY-l.fromY)}else{l.play(l.toX,l.toY)}return false};jQuery(this.jqId+"_boardFascade").mousemove(h).mouseout(i).mousedown(g);this.setToggleNumberImg();jQuery(this.jqId+"_goToInput").keydown(function(){if(e.keyCode==13){gvGoTo(id)}});this.addPrisonerHandlers();this.registerKeyListener();jQuery(document).ready(function(){tb_init("a.thickbox")});return this},addPrisonerHandlers:function(){var f=this;jQuery(this.jqId+"_moveOuter, "+this.jqId+"_blackPrisonersOuter, "+this.jqId+"_whitePrisonersOuter").mouseout(function(){jQuery(f.jqId+"_prisoners").empty()});jQuery(this.jqId+"_blackPrisonersOuter").mouseover(function(){jQuery(f.jqId+"_prisoners").empty();if(f.gameState.blackPrisoners>0){jQuery.each(f.gameState.blackPrisonerPoints,function(g,h){f.showPrisoner(h)})}});jQuery(this.jqId+"_whitePrisonersOuter").mouseover(function(){jQuery(this.jqId+"_prisoners").empty();if(f.gameState.whitePrisoners>0){jQuery.each(f.gameState.whitePrisonerPoints,function(g,h){f.showPrisoner(h)})}});jQuery(this.jqId+"_moveOuter").mouseover(function(){jQuery(f.jqId+"_prisoners").empty();if(f.gameState.currentNode.blackPrisoners>0){jQuery.each(f.gameState.currentNode.blackPrisonerPoints,function(g,h){f.showPrisoner(h)})}if(f.gameState.currentNode.whitePrisoners>0){jQuery.each(f.gameState.currentNode.whitePrisonerPoints,function(g,h){f.showPrisoner(h)})}})},showPrisoner:function(p){var k=this;var n=p[0],l=p[1],i=p[2];var g=this.xyToArea(n,l);var h=g[0],m=g[1],f=g[2],o=g[3];if(this.config.gameType==jsGameViewer.DAOQI){var r=i==jsGameViewer.model.STONE_BLACK?"gvsprite-19-markblack":"gvsprite-19-markwhite";this.mapToPoints(n,l,function(u,x){var y=k.xyToArea(u,x);var A=y[0],z=y[1],w=y[2],t=y[3];var v="<div class='"+r+"' style='position:absolute;left:"+A+"px;top:"+z+"px;";if(k.gameState.board[n][l]==jsGameViewer.model.STONE_NONE){if(k.isInCentralArea(u,x)){v+="background-color:"+k.config.boardColorDQ+";"}else{v+="background-color:"+k.config.boardColor+";"}}v+="'></div>";jQuery(this.jqId+"_prisoners").append(v)})}else{var r=i==jsGameViewer.model.STONE_BLACK?"gvsprite-21-markblack":"gvsprite-21-markwhite";var q="<div class='"+r+"' style='position:absolute;left:"+h+"px;top:"+m+"px;";if(this.gameState.board[n][l]==jsGameViewer.model.STONE_NONE){q+="background-color:"+this.config.boardColor+";"}q+="'></div>";jQuery(this.jqId+"_prisoners").append(q)}},removeKeyListener:function(){jQuery(this.jqId+"_bannerbg").css("background-color",this.config.inactiveBackground)},registerKeyListener:function(){var g=this;for(var f=1;f<=jsGameViewer.length;f++){jsGameViewer[jsGameViewer.getGameId(f)].removeKeyListener()}jQuery(this.jqId+"_bannerbg").css("background-color",this.config.activeBackground);document.onkeydown=function(i){var h;if(window.event){h=window.event.keyCode}else{if(i){h=i.which}else{return}}i=i||window.event;switch(h){case 37:if(i.ctrlKey){if(i.altKey){g.backAll()}else{g.backN(g.config.fastMode)}}else{if(i.altKey&&i.shiftKey){g.backToComment()}else{g.back()}}return;case 39:if(i.ctrlKey){if(i.altKey){g.forwardAll()}else{g.forwardN(g.config.fastMode)}}else{if(i.altKey&&i.shiftKey){g.forwardToComment()}else{g.forward()}}return;case 46:g.remove();return}if(i.altKey&&i.shiftKey){switch(h){case 71:setTimeout("jsGameViewer."+g.id+".goToPopup()",100);break;case 77:g.toggleNumber();break;case 82:g.refresh();break;default:if(h>=65&&h<=90){g.goToBranch(h-65)}}}};return this},initGame:function(){return this.removeAllStones().setGameInfo().setGameState().addRemoveStones(this.gameState.currentNode.points)},setGameInfo:function(){if(this.isMyTurn()&&!this.game.isFinished()){jQuery(this.jqId+"_resign").show()}else{jQuery(this.jqId+"_resign").hide()}var l=jQuery(this.jqId+"_info").empty();var h=this.game;if(h==undefined||h==null){return this}if(jsGameViewer.notNull(h.name)){l.append("<div align='center' style='font-weight:bold'>"+jQuery.trim(h.name)+"</div>")}if(jsGameViewer.notNull(h.date)){l.append("<div>"+jsgvTranslations.time+": "+jQuery.trim(h.date)+"</div>")}if(jsGameViewer.notNull(h.place)){l.append("<div>"+jsgvTranslations.place+": "+jQuery.trim(h.place)+"</div>")}var m="&nbsp;&#8592; "+jsgvTranslations.play_first;var g="";if(jsGameViewer.notNull(h.blackRank)){g="&nbsp;("+h.blackRank+")"}var f="<div>"+jsgvTranslations.black+": <strong>"+jQuery.trim(h.blackName)+"</strong>"+g;if(h.getFirstPlayer()==jsGameViewer.model.STONE_BLACK){f+=m}f+="</div>";l.append(f);var k="";if(jsGameViewer.notNull(h.whiteRank)){k="&nbsp;("+h.whiteRank+")"}var i="<div>"+jsgvTranslations.white+": <strong>"+jQuery.trim(h.whiteName)+"</strong>"+k;if(h.getFirstPlayer()==jsGameViewer.model.STONE_WHITE){i+=m}i+="</div>";l.append(i);if(h.handicap>0){l.append("<div>"+jsgvTranslations.handicap+": "+h.handicap+"</div>")}else{l.append("<div>"+jsgvTranslations.rule+": "+jQuery.trim(h.rule)+"</div>");l.append("<div>"+jsgvTranslations.komi+": "+h.komi+"</div>")}l.append("<div>"+jsgvTranslations.moves+": "+h.getMoves()+"</div>");l.append("<div>"+jsgvTranslations.result+": "+jQuery.trim(h.result)+"</div>");return this},removeGameInfo:function(){jQuery(this.jqId+"_info").empty();return this},setGameState:function(){var f=this.gameState.currentNode;this.setNextPlayer(this.gameState.getNextPlayer());this.setMoveNumber(f.moveNumber);this.setPrisoners(this.gameState.blackPrisoners,this.gameState.whitePrisoners);if(f.type==jsGameViewer.model.NODE_MOVE){this.setMoveMark(f.x,f.y)}else{this.removeMoveMark()}this.setMarks(f.marks);this.setBranches();this.setComment();return this},moveBoard:function(q,o){var m=this;if(this.config.gameType!=jsGameViewer.DAOQI){return}var n=this.gameState.board;this.config.x0=n.normalize(this.config.x0+q);this.config.y0=n.normalize(this.config.y0+o);this.removeAllStones();this.removeBranches();this.removeMoveMark();var t="";for(var l=0;l<n.size;l++){for(var h=0;h<n.size;h++){var g=n[l][h];if(g==jsGameViewer.model.STONE_BLACK||g==jsGameViewer.model.STONE_WHITE){var r=0;if(this.config.showMoveNumber){r=this.gameState.getMoveNumber(l,h)}this.mapToPoints(l,h,function(i,s){t+=m.createStone(i,s,g,r)})}}}if(t.length>0){jQuery(this.jqId+"_boardPoints").append(t)}this.setBranches();var f=this.gameState.currentNode;if(f.type==jsGameViewer.model.NODE_MOVE){this.setMoveMark(f.x,f.y)}else{this.removeMoveMark()}var p=(this.config.y0-this.config.vbw)*this.config.gridSize;jQuery(this.jqId+"_vlabel").css("backgroundPosition","0px "+p+"px");var k=(this.config.x0-this.config.vbw)*this.config.gridSize;jQuery(this.jqId+"_hlabel").css("backgroundPosition",k+"px 0px");this.setMarks(f.marks);return this},mapToPoints_:function(n,l){var p=new Array();var f=n+this.config.x0,m=l+this.config.y0;var g=[];if(f>=0&&f<this.config.boardSizeDQ){g.push(f)}if(f>=this.config.boardSize){g.push(f-this.config.boardSize)}if(f<this.config.boardSizeDQ-this.config.boardSize){g.push(f+this.config.boardSize)}var o=[];if(m>=0&&m<this.config.boardSizeDQ){o.push(m)}if(m>=this.config.boardSize){o.push(m-this.config.boardSize)}if(m<this.config.boardSizeDQ-this.config.boardSize){o.push(m+this.config.boardSize)}for(var k=0;k<g.length;k++){for(var h=0;h<o.length;h++){p.push([g[k],o[h]])}}return p},mapToPoints:function(f,m,l){var k=this.mapToPoints_(f,m);for(var g=0;g<k.length;g++){var h=k[g];l(h[0],h[1])}return this},getStoneId:function(f,g){return this.id+"_point_"+f+"-"+g},createStone:function(l,k,g,n){var i="";if(this.config.gameType==jsGameViewer.DAOQI){if(g==jsGameViewer.model.STONE_BLACK){i="gvsprite-19-black"}else{if(g==jsGameViewer.model.STONE_WHITE){i="gvsprite-19-white"}else{return null}}}else{if(g==jsGameViewer.model.STONE_BLACK){i="gvsprite-21-black"}else{if(g==jsGameViewer.model.STONE_WHITE){i="gvsprite-21-white"}else{return null}}}var o="<div id='"+this.getStoneId(l,k)+"' class='"+i+"' style='position:absolute;left:";a=this.xyToArea(l,k);o+=a[0]+"px;top:"+a[1]+"px;'>";if(this.config.showMoveNumber&&n>0){var h="white";if(g==jsGameViewer.model.STONE_WHITE){h="black"}var m="medium";var f=0;if(n>=10&&n<100){m="small"}else{if(n>=100){m="x-small";f=1}}o+="<div style='display:table;width:"+a[2]+"px;height:"+a[3]+"px;#position:relative;overflow:hidden;'><div style='display:table-cell;vertical-align:middle;#position:absolute;#top:50%;'><div style='#position:relative;left:"+f+"px;width:100%;#top:-50%;text-align:center;color:"+h+";font-family:times;font-size:"+m+";'>"+n+"</div></div></div>"}else{o+="&nbsp;"}o+="</div>";return o},addStone:function(f,l,g){var k=this;var i=0;if(this.config.showMoveNumber){i=this.gameState.getMoveNumber(f,l)}if(this.config.gameType==jsGameViewer.DAOQI){this.mapToPoints(f,l,function(m,o){var n=k.createStone(m,o,g,i);if(n!=null){jQuery(k.jqId+"_boardPoints").append(n)}})}else{var h=this.createStone(f,l,g,i);if(h!=null){jQuery(this.jqId+"_boardPoints").append(h)}}return this},addRemoveStones:function(h){for(var g=0;g<h.length;g++){var f=h[g];this.removeStone(f.x,f.y);if(!f.deleteFlag){this.addStone(f.x,f.y,f.color)}}return this},removeStone:function(f,i){var h=this;if(this.config.gameType==jsGameViewer.DAOQI){this.mapToPoints(f,i,function(k,m){var l=jQuery("#"+h.getStoneId(k,m));l.remove()})}else{var g=jQuery("#"+this.getStoneId(f,i));g.remove()}return this},removeAllStones:function(){jQuery(this.jqId+"_boardPoints").children().remove();return this},setNextPlayer:function(f){var g="";if(f==jsGameViewer.model.STONE_WHITE){g=this.config.viewDir+"/images/15/white.gif"}else{g=this.config.viewDir+"/images/15/black.gif"}jQuery(this.jqId+"_nextPlayer").attr("src",g);return this},setMoveNumber:function(f){if(f==0){f="0"}jQuery(this.jqId+"_curMove").empty().append(f);return this},setMoveMark:function(f,h){var g=this;if(this.config.gameType==jsGameViewer.DAOQI){jQuery(this.jqId+"_moveMarks").empty();this.mapToPoints(f,h,function(i,l){var k=g.xyToArea(i,l);jQuery(g.jqId+"_moveMarks").append("<div class='gvsprite-19-markmove' style='position:absolute;left:"+k[0]+"px;top:"+k[1]+"px;width:"+k[2]+"px;height:"+k[3]+"px'>&nbsp;</div>")})}else{jQuery(this.jqId+"_moveMark").css({position:"absolute",left:f*this.config.gridSize,top:h*this.config.gridSize,width:this.config.gridSize,height:this.config.gridSize})}return this},removeMoveMark:function(){if(this.config.gameType==jsGameViewer.DAOQI){jQuery(this.jqId+"_moveMarks").empty()}else{jQuery(this.jqId+"_moveMark").css({width:0,height:0})}return this},setMarks:function(r){var o=this;jQuery(this.jqId+"_boardMarks").empty();if(r==undefined||r==null){return this}if(this.config.gameType==jsGameViewer.DAOQI){for(var m=0;m<r.length;m++){var k=r[m];var t=k[0],q=k[1];var l=this.gameState.board[t][q];var n="";switch(k[2]){case jsGameViewer.model.MARK_CROSS:n="gvsprite-19-markcross";break;case jsGameViewer.model.MARK_TRIANGLE:n="gvsprite-19-marktriangle";break;case jsGameViewer.model.MARK_SQUARE:n="gvsprite-19-marksquare";break;case jsGameViewer.model.MARK_CIRCLE:n="gvsprite-19-markcircle";break;case jsGameViewer.model.MARK_TERR_BLACK:n="gvsprite-19-markblack";break;case jsGameViewer.model.MARK_TERR_WHITE:n="gvsprite-19-markwhite";break;case jsGameViewer.model.MARK_TEXT:this.mapToPoints(t,q,function(w,E){var B=o.xyToArea(w,E);var D=B[0],C=B[1],A=B[2],i=B[3];var z="<div style='position:absolute;left:"+D+"px;top:"+C+"px;width:"+A+"px;height:"+i+"px;text-align:center;vertical-align:middle;color:red;font-family:Nina;font-weight:bolder;font-size:14px;";if(l==jsGameViewer.model.STONE_NONE){if(o.isInCentralArea(w,E)){z+="background-color:"+o.config.boardColorDQ+";"}else{z+="background-color:"+o.config.boardColor+";"}}z+="'>"+k[3]+"</div>";jQuery(o.jqId+"_boardMarks").append(z)});continue}this.mapToPoints(t,q,function(w,E){var B=o.xyToArea(w,E);var D=B[0],C=B[1],A=B[2],i=B[3];var z="<div class='"+n+"' style='position:absolute;left:"+D+"px;top:"+C+"px;";if(l==jsGameViewer.model.STONE_NONE){if(o.isInCentralArea(w,E)){z+="background-color:"+o.config.boardColorDQ+";"}else{z+="background-color:"+o.config.boardColor+";"}}z+="'></div>";jQuery(o.jqId+"_boardMarks").append(z)})}}else{for(var m=0;m<r.length;m++){var k=r[m];var t=k[0],q=k[1];var l=this.gameState.board[t][q];var g=this.xyToArea(t,q);var h=g[0],p=g[1],f=g[2],u=g[3];var n="";switch(k[2]){case jsGameViewer.model.MARK_CROSS:n="gvsprite-21-markcross";break;case jsGameViewer.model.MARK_TRIANGLE:n="gvsprite-21-marktriangle";break;case jsGameViewer.model.MARK_SQUARE:n="gvsprite-21-marksquare";break;case jsGameViewer.model.MARK_CIRCLE:n="gvsprite-21-markcircle";break;case jsGameViewer.model.MARK_TERR_BLACK:n="gvsprite-21-markblack";break;case jsGameViewer.model.MARK_TERR_WHITE:n="gvsprite-21-markwhite";break;case jsGameViewer.model.MARK_TEXT:var v="<div style='position:absolute;left:"+h+"px;top:"+p+"px;width:"+f+"px;height:"+u+"px;text-align:center;vertical-align:middle;color:red;font-family:Nina;font-weight:bolder;font-size:15px;";if(l==jsGameViewer.model.STONE_NONE){v+="background-color:"+this.config.boardColor+";"}v+="'>"+k[3]+"</div>";jQuery(this.jqId+"_boardMarks").append(v);continue}var v="<div class='"+n+"' style='position:absolute;left:"+h+"px;top:"+p+"px;";if(l==jsGameViewer.model.STONE_NONE){v+="background-color:"+this.config.boardColor+";"}v+="'></div>";jQuery(this.jqId+"_boardMarks").append(v)}}return this},setPrisoners:function(f,g){if(f==0){f="0"}if(g==0){g="0"}jQuery(this.jqId+"_blackPrisoners").empty().append(f);jQuery(this.jqId+"_whitePrisoners").empty().append(g);return this},setBranches:function(){var m=this;jQuery(this.jqId+"_boardBranches").empty();jQuery(this.jqId+"_branches").empty();jQuery(this.jqId+"_branches").css({height:0});var k=this.gameState.currentNode;if(k.hasChildren()&&k.children.length>=2){var h=k.children.length;for(var l=0;l<k.children.length;l++){var r="";if(l==0){r=jsgvTranslations.branch+" A = "+jsgvTranslations.trunk+" [Alt Shift &#8594;][Alt Shift A]"}else{if(l<b.length){var o=b[l];r=jsgvTranslations.branch+" "+o+" [Alt Shift "+o+"]"}}var t="<div class='gvtb-branch gvbutton'><a href='#' title='"+r+"' onclick='jsGameViewer."+this.id+".goToBranch("+l+");return false;'>"+b[l]+"</a></div>";jQuery(this.jqId+"_branches").append(t);jQuery(this.jqId+"_branches").css({height:h*23});var g=k.children[l];if(g.type==jsGameViewer.model.NODE_MOVE){var q=g.x,p=g.y;if(this.config.gameType==jsGameViewer.DAOQI){this.mapToPoints(q,p,function(i,u){var n="gvbranch";if(m.isInCentralArea(i,u)){n="gvbranch-real"}var s=m.xyToArea(i,u);jQuery(m.jqId+"_boardBranches").append("<div class='"+n+"' style='left:"+s[0]+"px;top:"+s[1]+"px;width:"+s[2]+"px;height:"+s[3]+"px;'>"+b[l]+"</div>")})}else{var f=m.xyToArea(q,p);jQuery(m.jqId+"_boardBranches").append("<div class='gvbranch' style='left:"+f[0]+"px;top:"+f[1]+"px;width:"+f[2]+"px;height:"+f[3]+"px;'>"+b[l]+"</div>")}}}}return this},removeBranches:function(){jQuery(this.jqId+"_boardBranches").empty();jQuery(this.jqId+"_branches").empty();jQuery(this.jqId+"_branches").css({height:0});return this},setComment:function(g){var f=this.gameState.currentNode;if(!g){g="<strong>";if(f.depth>1){g+=jsgvTranslations.branch_tag}g+=jsgvTranslations.comment_for.replace(/MOVE/,f.moveNumber)+":</strong>";if(f.comment!=undefined&&f.comment!=null){g+="<br/>"+f.comment.replace(/\n/g,"<br/>\n")}}jQuery(this.jqId+"_comment").empty().append(g);jQuery(this.jqId+"_comment").height(this.rightPaneHeight-jQuery(this.jqId+"_info").height()-12);return this},removeComment:function(){jQuery(this.jqId+"_comment").empty();return this},redrawBoard:function(){var n=this;var l=this.gameState.board;var k="";if(this.config.gameType==jsGameViewer.DAOQI){for(var h=0;h<l.size;h++){for(var g=0;g<l.size;g++){var f=l[h][g];var m=0;if(this.config.showMoveNumber){m=this.gameState.getMoveNumber(h,g)}if(f==jsGameViewer.model.STONE_BLACK||f==jsGameViewer.model.STONE_WHITE){this.mapToPoints(h,g,function(i,o){k+=n.createStone(i,o,f,m)})}}}}else{for(var h=0;h<l.size;h++){for(var g=0;g<l.size;g++){var f=l[h][g];var m=0;if(this.config.showMoveNumber){m=this.gameState.getMoveNumber(h,g)}if(f==jsGameViewer.model.STONE_BLACK||f==jsGameViewer.model.STONE_WHITE){k+=this.createStone(h,g,f,m)}}}}jQuery(this.jqId+"_boardPoints").empty();if(k.length>0){jQuery(this.jqId+"_boardPoints").append(k)}return this},play:function(f,o){if(this.gameState==null){return this}var n=this;if(this.gameState.board[f][o]!=0){if(this.gameState.isFirst()){return false}var k=new Array();var m=false;for(;;){var l=this.gameState.currentNode;if(l.type==jsGameViewer.model.NODE_MOVE&&l.x==f&&l.y==o){break}if(!this.back_(k)){break}m=true}if(m){jQuery.each(k,function(q,p){n.removeStone(p.x,p.y);if(p.deleteFlag){n.addStone(p.x,p.y,p.color)}});this.setGameState();return true}return false}if(!this.gameState.isLast()){var h=this.gameState.currentNode.children;for(var g=0;g<h.length;g++){var l=h[g];if(l.type==jsGameViewer.model.NODE_MOVE&&l.x==f&&l.y==o){return this.goToBranch(g)}}}if(this.gameState.play(f,o)){var l=this.gameState.currentNode;jQuery.each(l.points,function(q,p){n.removeStone(p.x,p.y);if(!p.deleteFlag){n.addStone(p.x,p.y,p.color)}});this.setGameState();return true}else{return false}},remove:function(){var g=this;if(this.gameState!=null&&this.gameState.canRemove()){var f=this.gameState.currentNode;jQuery.each(f.points,function(k,h){g.removeStone(h.x,h.y);if(h.deleteFlag){g.addStone(h.x,h.y,h.color)}});this.gameState.remove();this.setGameState()}return this},back_:function(k){if(this.gameState.isFirst()){return false}var l=this.gameState.currentNode;for(var h=0;h<l.points.length;h++){var f=l.points[h];var m=false;for(var g=0;g<k.length;g++){var n=k[g];if(f.x==n.x&&f.y==n.y){m=true;k[g]=f;break}}if(!m){k.push(f)}}this.gameState.back();return true},back:function(){if(this.gameState==null){return this}if(this.gameState.isFirst()){return false}var g=this;var f=this.gameState.currentNode;jQuery.each(f.points,function(k,h){g.removeStone(h.x,h.y);if(h.deleteFlag){g.addStone(h.x,h.y,h.color)}});this.gameState.back();this.setGameState();return true},backN:function(l){if(this.gameState==null){return this}var k=this;if(l==undefined){l=this.config.fastMode}var g=new Array();var h=false;for(var f=0;f<l;f++){if(!this.back_(g)){break}h=true}if(h){jQuery.each(g,function(n,m){k.removeStone(m.x,m.y);if(m.deleteFlag){k.addStone(m.x,m.y,m.color)}});this.setGameState()}return this},backToComment:function(){if(this.gameState==null){return this}var i=this;var f=new Array();var h=false;for(;;){if(!this.back_(f)){break}h=true;var g=this.gameState.currentNode;if(g.hasComment()||g.hasBranches()){break}}if(h){jQuery.each(f,function(l,k){i.removeStone(k.x,k.y);if(k.deleteFlag){i.addStone(k.x,k.y,k.color)}});this.setGameState()}return this},backAll:function(){if(this.gameState==null){return this}var g=this;this.removeAllStones();this.gameState.backAll();var f=this.gameState.currentNode;jQuery.each(f.points,function(k,h){if(h.color==jsGameViewer.model.STONE_BLACK||h.color==jsGameViewer.model.STONE_WHITE){g.addStone(h.x,h.y,h.color)}});this.setGameState();return this},forward_:function(k){if(this.gameState.isLast()){return false}this.gameState.forward();var l=this.gameState.currentNode;for(var h=0;h<l.points.length;h++){var f=l.points[h];var m=false;for(var g=0;g<k.length;g++){var n=k[g];if(f.x==n.x&&f.y==n.y){m=true;k[g]=f;break}}if(!m){k.push(f)}}return true},forward:function(){if(this.gameState==null){return this}if(!this.gameState.forward()){return false}var g=this;var f=this.gameState.currentNode;jQuery.each(f.points,function(k,h){g.removeStone(h.x,h.y);if(!h.deleteFlag){g.addStone(h.x,h.y,h.color)}});this.setGameState();return true},forwardN:function(l){if(this.gameState==null){return this}var k=this;if(l==undefined){l=this.config.fastMode}var g=new Array();var h=false;for(var f=0;f<l;f++){if(!this.forward_(g)){break}h=true}if(h){jQuery.each(g,function(n,m){k.removeStone(m.x,m.y);if(!m.deleteFlag){k.addStone(m.x,m.y,m.color)}});this.setGameState()}return this},forwardToComment:function(){if(this.gameState==null){return this}var i=this;var f=new Array();var h=false;for(;;){if(!this.forward_(f)){break}h=true;var g=this.gameState.currentNode;if(g.hasComment()||g.hasBranches()){break}}if(h){jQuery.each(f,function(l,k){i.removeStone(k.x,k.y);if(!k.deleteFlag){i.addStone(k.x,k.y,k.color)}});this.setGameState()}return this},forwardAll:function(){if(this.gameState==null){return this}this.removeAllStones();this.gameState.forwardAll();this.redrawBoard();this.setGameState();return this},goToBranch:function(h){if(this.gameState==null){return this}if(!this.gameState.goToBranch(h)){return this}var g=this;var f=this.gameState.currentNode;jQuery.each(f.points,function(l,k){g.removeStone(k.x,k.y);if(!k.deleteFlag){g.addStone(k.x,k.y,k.color)}});this.setGameState();return this},goTo:function(i){if(this.gameState==null){return this}var h=this;while(this.gameState.isOnBranch()){this.back()}if(i>=this.gameState.game.getMoves()){this.forwardAll()}else{if(i<=0){this.backAll()}else{if(i>this.gameState.currentNode.moveNumber){var f=new Array();var g=false;while(i>this.gameState.currentNode.moveNumber){if(!this.forward_(f)){break}g=true}if(g){jQuery.each(f,function(l,k){h.removeStone(k.x,k.y);if(!k.deleteFlag){h.addStone(k.x,k.y,k.color)}});this.setGameState()}}else{if(i<this.gameState.currentNode.moveNumber){var f=new Array();var g=false;while(i<this.gameState.currentNode.moveNumber){if(!this.back_(f)){break}g=true}if(g){jQuery.each(f,function(l,k){h.removeStone(k.x,k.y);if(k.deleteFlag){h.addStone(k.x,k.y,k.color)}});this.setGameState()}}}}}return this},goToXYs:function(g){this.backAll();for(var h=0;h<g.length;h++){var f=g[h][0],l=g[h][1];var k=this.gameState.currentNode.childThatMatches(f,l);if(k!=null){this.goToBranch(k)}else{break}}return this},setToggleNumberImg:function(){if(this.config.showMoveNumber){jQuery(this.jqId+"_toggleNumberImg").removeClass("gvsprite-hidenumber");jQuery(this.jqId+"_toggleNumberImg").addClass("gvsprite-shownumber")}else{jQuery(this.jqId+"_toggleNumberImg").removeClass("gvsprite-shownumber");jQuery(this.jqId+"_toggleNumberImg").addClass("gvsprite-hidenumber")}return this},toggleNumber:function(){if(this.config.showMoveNumber){this.config.showMoveNumber=false}else{this.config.showMoveNumber=true}this.setToggleNumberImg();if(this.gameState==null){return this}this.redrawBoard();return this},showNumber:function(){if(this.config.hideMoveNumber){this.toggleNumber()}return this},hideNumber:function(){if(this.config.showMoveNumber){this.toggleNumber()}return this},eventToXY:function(g){g=g.originalEvent||window.event;layerX=g.layerX||g.offsetX||g.clientX;layerY=g.layerY||g.offsetY||g.clientY;var f=parseInt(layerX/this.config.gridSize);var h=parseInt(layerY/this.config.gridSize);if(this.config.gameType==jsGameViewer.DAOQI){f=(f+this.config.boardSize-this.config.x0)%this.config.boardSize;h=(h+this.config.boardSize-this.config.y0)%this.config.boardSize}return[f,h]},isInCentralArea:function(f,g){return f>=this.config.vbw&&f<this.config.boardSize+this.config.vbw&&g>=this.config.vbw&&g<this.config.boardSize+this.config.vbw},xyToArea:function(f,g){return[f*this.config.gridSize,g*this.config.gridSize,this.config.gridSize,this.config.gridSize]},xyToLabel:function(f,h){var g=d[f];g+=this.config.boardSize-parseInt(h);return g},postThickBoxFix:function(){this.registerKeyListener()},goToPopup:function(){var f="#TB_inline?test=0&width=250&height=56&inlineId="+this.id+"_goTo&focus="+this.id+"_goToInput&modal=true&test1=0";tb_show("",f,null)},goToOkHandler:function(){try{var f=document.getElementsByName(this.id+"_goToForm")[1].goToInput.value;tb_remove();var g=parseInt(f);this.goTo(g)}catch(h){throw"GameController().goToOkHandler(): "+h}this.postThickBoxFix()},goToKeyDown:function(f,h){var g;if(window.event){g=window.event.keyCode}else{if(h){g=h.which}else{return}}if(g==13){gvGoToInput=f.value;this.goToOkHandler()}else{if(g==27){tb_remove();this.postThickBoxFix()}}}}}());jQuery.extend(jsGameViewer.GameController.prototype,{setPlayer:function(b){this.player=b;return this},saveSession:function(d,b){if(!this.sessionSaver){this.sessionSaver=setInterval(function(){jQuery.ajax({url:d})},b*1000)}return this},setUsernameElemId:function(b){this.usernameElemId=b;return this},setUsername:function(b){this.username=b;return this},getUsername:function(){if(this.username){return this.username}else{if(this.usernameElemId){return jQuery.trim(jQuery("#"+this.usernameElemId).text())}else{return null}}},isPlayer:function(){if(this.player&&this.player.isPlayer){return this.player.isPlayer()}else{return false}},isMyTurn:function(){if(this.player&&this.player.isMyTurn){return this.player.isMyTurn()}else{return false}},sendMove:function(){if(this.player&&this.player.sendMove){return this.player.sendMove()}else{return false}},resign:function(){if(this.player&&this.player.resign){if(confirm(jsgvTranslations.confirm_resign)){this.player.resign()}}else{return false}},origPlay:jsGameViewer.GameController.prototype.play,play:function(b,d){if(this.origPlay(b,d)&&this.player&&this.player.sendMove){return this.player.sendMove()}}});